<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ£ÛŒÛŒØ¯ Ú©Ø¯ Cyrus AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* (Ø§Ø² Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ account_login.html Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯) */
        :root {
            --bg-dark: #070707; --card-dark: #1e1e1e; --highlight-color: #03A9F4; 
            --text-color: #FAFAFA; --error-color: #FF4444; --success-color: #00CC66;
            --border-radius: 12px;
        }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Vazirmatn', sans-serif;}
        body { background: var(--bg-dark); color: var(--text-color); display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .login-card { 
            background: var(--card-dark); padding: 30px; border-radius: var(--border-radius); width: 90%; 
            max-width: 400px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5); direction: rtl;
            position: relative; /* ğŸ†• Ø¨Ø±Ø§ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒØ¯Ù‡ÛŒ Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª */
        }
        .login-card h2 { text-align: center; color: var(--highlight-color); margin-bottom: 30px; }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; margin-bottom: 8px; font-size: 0.9rem; color: #ccc; }
        .input-group input { width: 100%; padding: 12px; border: 1px solid #333; border-radius: 8px; background: #2a2a2a; color: var(--text-color); font-size: 1.2rem; text-align: center; outline: none; transition: border-color 0.3s;}
        .input-group input:focus { border-color: var(--highlight-color); }
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; background: var(--highlight-color); color: var(--bg-dark); font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: background-color 0.3s, opacity 0.3s;}
        button:hover:not(:disabled) { background: #0077C0; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .status-message { margin-top: 20px; padding: 10px; border-radius: 8px; text-align: center; }
        .status-message.error { background: rgba(255, 68, 68, 0.2); color: var(--error-color); }
        .status-message.success { background: rgba(0, 204, 102, 0.2); color: var(--success-color); }
        .email-display { font-size: 0.9rem; color: #aaa; text-align: center; margin-bottom: 15px; }
        .resend-link { display: block; text-align: center; margin-top: 15px; font-size: 0.9rem; color: var(--highlight-color); cursor: pointer; text-decoration: none;}
        
        /* ğŸ†• Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª */
        .back-button {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #888;
            font-size: 1.3rem;
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .back-button:hover {
            color: var(--highlight-color);
        }
    </style>
</head>
<body>

<div class="login-card">
    
    <a href="javascript:history.back()" class="back-button" title="Ø¨Ø§Ø²Ú¯Ø´Øª">
        <i class="fas fa-arrow-right"></i>
    </a>
    
    <h2><i class="fas fa-shield-alt"></i> ØªØ£ÛŒÛŒØ¯ Ù†Ù‡Ø§ÛŒÛŒ</h2>
    
    <div class="email-display">
        Ú©Ø¯ ØªØ£ÛŒÛŒØ¯ Ø¨Ù‡ Ø¢Ø¯Ø±Ø³ Ø²ÛŒØ± Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡ Ø§Ø³Øª:<br>
        <strong id="email-address"></strong>
    </div>

    <div class="input-group">
        <label for="code">Ú©Ø¯ Û¶ Ø±Ù‚Ù…ÛŒ ØªØ£ÛŒÛŒØ¯</label>
        <input type="text" id="code-input" placeholder="Ù…Ø«Ù„Ø§Ù‹: 123456" maxlength="6" required>
    </div>
    
    <button id="verify-btn" onclick="verifyCode()">
        ØªØ£ÛŒÛŒØ¯ Ùˆ ÙˆØ±ÙˆØ¯
    </button>
    
    <a href="#" class="resend-link" onclick="resendCode()">Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯ Ú©Ø¯</a>

    <div id="status-message" class="status-message" style="display:none;"></div>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const email = urlParams.get('email');
    
    const emailDisplay = document.getElementById('email-address');
    const codeInput = document.getElementById('code-input');
    const verifyBtn = document.getElementById('verify-btn');
    const statusDiv = document.getElementById('status-message');

    if (email) {
        emailDisplay.textContent = email;
    } else {
        window.location.href = '/account.html'; // Ø§Ú¯Ø± Ø§ÛŒÙ…ÛŒÙ„ Ø¯Ø± URL Ù†Ø¨ÙˆØ¯ØŒ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†
    }

    function showStatus(message, type) {
        statusDiv.textContent = message;
        statusDiv.className = 'status-message ' + type;
        statusDiv.style.display = 'block';
    }

    async function verifyCode() {
        const code = codeInput.value.trim();
        if (code.length !== 6 || isNaN(code)) {
            showStatus("Ù„Ø·ÙØ§Ù‹ Ú©Ø¯ Û¶ Ø±Ù‚Ù…ÛŒ ØµØ­ÛŒØ­ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.", 'error');
            return;
        }

        verifyBtn.disabled = true;
        verifyBtn.textContent = "Ø¯Ø± Ø­Ø§Ù„ ØªØ£ÛŒÛŒØ¯...";
        showStatus("Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø¯ ØªØ£ÛŒÛŒØ¯...", 'success');

        try {
            const response = await fetch("/verify_code", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email: email, code: code })
            });

            const data = await response.json();
            
            if (response.ok && data.status === "success") {
                showStatus("âœ… ØªØ£ÛŒÛŒØ¯ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ². Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!", 'success');
                // ğŸ’¡ Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ ØµÙØ­Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„
                setTimeout(() => {
                    window.location.href = data.redirect; 
                }, 1500);

            } else {
                showStatus("âŒ " + data.message, 'error');
                verifyBtn.textContent = "ØªØ£ÛŒÛŒØ¯ Ùˆ ÙˆØ±ÙˆØ¯";
                verifyBtn.disabled = false;
            }

        } catch (e) {
            console.error("Fetch Error:", e);
            showStatus("âš ï¸ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ ÛŒØ§ Ø³Ø±ÙˆØ± Ø±Ø® Ø¯Ø§Ø¯.", 'error');
            verifyBtn.textContent = "ØªØ£ÛŒÛŒØ¯ Ùˆ ÙˆØ±ÙˆØ¯";
            verifyBtn.disabled = false;
        }
    }
    
    // ğŸ’¡ ØªØ§Ø¨Ø¹ Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯ Ú©Ø¯
    async function resendCode() {
        const resendLink = document.querySelector('.resend-link');
        resendLink.style.pointerEvents = 'none'; // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ú©Ù„ÛŒÚ© Ù…Ø¬Ø¯Ø¯
        resendLink.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯...';
        
        try {
            const response = await fetch("/send_code", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email: email })
            });
            
            const data = await response.json();
            
            if (response.ok && data.status === "success") {
                showStatus("âœ… Ú©Ø¯ Ø¬Ø¯ÛŒØ¯ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯. 5 Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¯ÛŒÚ¯Ø± ØµØ¨Ø± Ú©Ù†ÛŒØ¯.", 'success');
            } else {
                showStatus("âŒ Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯ Ú©Ø¯ Ø±Ø® Ø¯Ø§Ø¯.", 'error');
            }
        } catch (e) {
            showStatus("âš ï¸ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯.", 'error');
        } finally {
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù…Ø¬Ø¯Ø¯ Ø¯Ú©Ù…Ù‡ Ø¨Ø¹Ø¯ Ø§Ø² 60 Ø«Ø§Ù†ÛŒÙ‡
            setTimeout(() => {
                resendLink.textContent = 'Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯ Ú©Ø¯';
                resendLink.style.pointerEvents = 'auto';
            }, 60000); 
        }
    }
</script>

</body>
</html>