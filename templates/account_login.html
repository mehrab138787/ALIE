<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙˆØ±ÙˆØ¯ | Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø´Ù…Ø§</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        /* Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø±Ù†Ú¯ */
        :root {
            --bg-dark: #070707; /* Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø§ØµÙ„ÛŒ */
            --card-dark: #1e1e1e; /* Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ú©Ø§Ø±Øª/ÙØ±Ù… */
            /* Ø§Ø² Ø±Ù†Ú¯ Ø¨Ù†ÙØ´ Ø¨Ø±Ø§ÛŒ ØªØ£Ú©ÛŒØ¯ Ø¨Ø± Ú©ÛŒÙˆØª Ùˆ Ø´ÛŒÚ© Ø¨ÙˆØ¯Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯ */
            --highlight-color: #5E35B1; 
            --highlight-color-light: #7E57C2;
            --text-color: #FAFAFA; /* Ø±Ù†Ú¯ Ù…ØªÙ† Ø§ØµÙ„ÛŒ */
            --text-secondary: #B0B0B0; /* Ø±Ù†Ú¯ Ù…ØªÙ† Ø«Ø§Ù†ÙˆÛŒÙ‡ */
            --error-color: #E53935; /* Ø±Ù†Ú¯ Ø®Ø·Ø§ */
            --success-color: #4CAF50; /* Ø±Ù†Ú¯ Ù…ÙˆÙÙ‚ÛŒØª */
            --border-radius: 16px;
            --input-bg: #2b2b2b;
        }

        /* Ø±ÛŒØ³Øª Ùˆ ÙÙˆÙ†Øª */
        * { 
            margin:0; 
            padding:0; 
            box-sizing:border-box; 
            font-family:'Vazirmatn', sans-serif;
            direction: rtl; 
        }
        
        body { 
            background: var(--bg-dark); 
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* Ø³Ø§Ø®ØªØ§Ø± Ú©Ø§Ø±Øª Ø§ØµÙ„ÛŒ */
        .login-container {
            width: 100%;
            max-width: 400px;
            background: var(--card-dark);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease-in-out;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Ù‡Ø¯Ø± Ø´ÛŒÚ© */
        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h2 {
            font-weight: 700;
            color: var(--highlight-color);
            margin-bottom: 5px;
            font-size: 1.8rem;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§ (Status Messages) */
        #status-message {
            margin-bottom: 20px;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            text-align: center;
            min-height: 40px;
            transition: opacity 0.3s ease;
            opacity: 0;
        }
        .status-show { opacity: 1 !important; }

        .status-error { background-color: rgba(229, 57, 53, 0.2); color: var(--error-color); border: 1px solid var(--error-color); }
        .status-success { background-color: rgba(76, 175, 80, 0.2); color: var(--success-color); border: 1px solid var(--success-color); }
        .status-info { background-color: rgba(94, 53, 177, 0.2); color: var(--highlight-color-light); border: 1px solid var(--highlight-color-light); }


        /* ÙÛŒÙ„Ø¯ ÙˆØ±ÙˆØ¯ÛŒ Ø´ÛŒÚ© */
        .input-group {
            position: relative;
            margin-bottom: 25px;
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            background: var(--input-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text-color);
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
            text-align: right;
            direction: ltr; /* Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†ØŒ Ø¬Ù‡Øª Ú†Ù¾ Ø¨Ù‡ Ø±Ø§Ø³Øª */
        }

        .input-group input:focus {
            border-color: var(--highlight-color);
            box-shadow: 0 0 0 3px rgba(94, 53, 177, 0.3);
            outline: none;
        }

        .input-group label {
            position: absolute;
            top: -10px;
            right: 15px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            background: var(--card-dark);
            padding: 0 5px;
            transition: color 0.3s;
            z-index: 10;
        }
        
        /* Ø¯Ú©Ù…Ù‡ Ø§ØµÙ„ÛŒ (Ø¨Ù†ÙØ´) */
        .primary-btn {
            width: 100%;
            padding: 14px;
            background: var(--highlight-color);
            color: var(--text-color);
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.3s, transform 0.1s;
            box-shadow: 0 4px 15px rgba(94, 53, 177, 0.4);
            margin-top: 10px;
        }

        .primary-btn:hover {
            background: var(--highlight-color-light);
            box-shadow: 0 6px 20px rgba(94, 53, 177, 0.6);
        }

        .primary-btn:disabled {
            background: #3a3a3a;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ù…Ø±Ø­Ù„Ù‡ ØªØ£ÛŒÛŒØ¯ Ú©Ø¯ */
        #verify-form {
            display: none; /* Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† ÙØ±Ù… ØªØ£ÛŒÛŒØ¯ Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ */
        }
        
        .code-input-wrapper {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .code-input-wrapper input {
            width: 60px;
            height: 60px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background: var(--input-bg);
            color: var(--text-color);
            /* Ø¨Ø±Ø§ÛŒ ØªØ§ÛŒÙ¾ Ú©Ø¯ ØªØ£ÛŒÛŒØ¯ØŒ Ø¬Ù‡Øª Ú†Ù¾ Ø¨Ù‡ Ø±Ø§Ø³Øª */
            direction: ltr; 
        }
        
        .resend-link {
            display: block;
            text-align: center;
            margin-top: 15px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.9rem;
            transition: color 0.3s;
        }
        
        .resend-link:hover {
            color: var(--highlight-color);
        }
        
        #resend-timer {
            font-weight: 700;
            color: var(--highlight-color);
        }

        /* Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
        .fa-spin {
            animation: fa-spin 1s infinite linear;
        }
        @keyframes fa-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

    </style>
</head>
<body>

    <div class="login-container">
        
        <div class="header">
            <i class="fas fa-mobile-alt" style="font-size: 2.5rem; color: var(--highlight-color); margin-bottom: 10px;"></i>
            <h2>ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†</h2>
            <p>Ø³Ø§Ø¯Ù‡â€ŒØªØ±ÛŒÙ† Ø±Ø§Ù‡ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ ÛŒØ§ Ø«Ø¨Øª Ù†Ø§Ù… Ø³Ø±ÛŒØ¹.</p>
        </div>

        <div id="status-message" class="status-info"></div>

        <form id="phone-form" onsubmit="event.preventDefault(); sendVerificationCode();">
            <div class="input-group">
                <label for="phone">Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†</label>
                <input type="text" id="phone" name="phone" placeholder="Ù…Ø«Ø§Ù„: 09123456789" required maxlength="11" pattern="^09\d{9}$" inputmode="numeric">
            </div>
            
            <button type="submit" id="send-code-btn" class="primary-btn">
                <i class="fas fa-paper-plane"></i> Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ø¯ ØªØ£ÛŒÛŒØ¯
            </button>
        </form>

        <form id="verify-form" onsubmit="event.preventDefault(); verifyCode();">
            <div class="input-group">
                <p style="text-align: center; margin-bottom: 15px; color: var(--text-secondary);">
                    Ú©Ø¯ <span id="code-length">Û¶</span> Ø±Ù‚Ù…ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡ Ø¨Ù‡
                    <strong id="sent-to-phone" style="color: var(--highlight-color-light);"></strong> Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.
                </p>
                <div class="code-input-wrapper">
                    <input type="text" maxlength="1" id="code1" class="code-input" inputmode="numeric" pattern="[0-9]" required>
                    <input type="text" maxlength="1" id="code2" class="code-input" inputmode="numeric" pattern="[0-9]" required>
                    <input type="text" maxlength="1" id="code3" class="code-input" inputmode="numeric" pattern="[0-9]" required>
                    <span style="color: var(--text-secondary); font-size: 1.5rem; line-height: 0.8;">-</span>
                    <input type="text" maxlength="1" id="code4" class="code-input" inputmode="numeric" pattern="[0-9]" required>
                    <input type="text" maxlength="1" id="code5" class="code-input" inputmode="numeric" pattern="[0-9]" required>
                    <input type="text" maxlength="1" id="code6" class="code-input" inputmode="numeric" pattern="[0-9]" required>
                </div>
            </div>

            <button type="submit" id="verify-btn" class="primary-btn">
                <i class="fas fa-check-circle"></i> ØªØ£ÛŒÛŒØ¯ Ùˆ ÙˆØ±ÙˆØ¯
            </button>
            
            <a href="#" class="resend-link" id="resend-link" onclick="resendCode(event);">
                <i class="fas fa-redo"></i> Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯ Ú©Ø¯ (<span id="resend-timer">60</span> Ø«Ø§Ù†ÛŒÙ‡)
            </a>
            <a href="#" class="resend-link" onclick="goBackToPhoneInput(event);" style="margin-top: 10px;">
                <i class="fas fa-chevron-right"></i> ØªØºÛŒÛŒØ± Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†
            </a>
        </form>

    </div> <script>
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø³Ø±Ø§Ø³Ø±ÛŒ
        let currentPhone = '';
        let timerInterval;
        const RESEND_TIME_SECONDS = 60; 

        // ------------------------------------
        // ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ
        // ------------------------------------

        /** Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª */
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status-message');
            statusDiv.className = `status-${type} status-show`;
            statusDiv.innerHTML = message;
        }
        
        /** Ø´Ø±ÙˆØ¹ ØªØ§ÛŒÙ…Ø± Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯ */
        function startTimer() {
            let timeLeft = RESEND_TIME_SECONDS;
            const timerElement = document.getElementById('resend-timer');
            const resendLink = document.getElementById('resend-link');
            
            resendLink.style.cursor = 'not-allowed';
            resendLink.onclick = (e) => e.preventDefault();
            
            // Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒÙ†Ú© Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯ Ø¨Ø§ ØªØ§ÛŒÙ…Ø±
            resendLink.innerHTML = `<i class="fas fa-redo"></i> Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯ Ú©Ø¯ (<span id="resend-timer">${timeLeft}</span> Ø«Ø§Ù†ÛŒÙ‡)`;
            
            clearInterval(timerInterval); 
            
            timerInterval = setInterval(() => {
                timeLeft--;
                timerElement.innerText = timeLeft; // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ù‚Ø¯Ø§Ø± Ø¯Ø§Ø®Ù„ span
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    resendLink.innerHTML = '<i class="fas fa-redo"></i> Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯ Ú©Ø¯';
                    resendLink.style.cursor = 'pointer';
                    resendLink.onclick = (e) => resendCode(e);
                }
            }, 1000);
        }

        /** ØªÙ…Ø±Ú©Ø² Ø®ÙˆØ¯Ú©Ø§Ø± Ø±ÙˆÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ú©Ø¯ */
        function setupCodeInputs() {
            const inputs = document.querySelectorAll('.code-input');
            inputs.forEach((input, index) => {
                // Ø­Ø±Ú©Øª Ø¨Ù‡ ÙÛŒÙ„Ø¯ Ø¨Ø¹Ø¯ÛŒ Ù‡Ù†Ú¯Ø§Ù… ØªØ§ÛŒÙ¾
                input.addEventListener('input', (e) => {
                    // ÙÙ‚Ø· Ø§Ø¹Ø¯Ø§Ø¯ Ù…Ø¬Ø§Ø² Ø§Ø³Øª
                    if (e.data && !/^\d$/.test(e.data)) {
                        input.value = '';
                        return;
                    }
                    if (input.value.length === input.maxLength && index < inputs.length - 1) {
                        inputs[index + 1].focus();
                    }
                });
                
                // Ø­Ø±Ú©Øª Ø¨Ù‡ ÙÛŒÙ„Ø¯ Ù‚Ø¨Ù„ÛŒ Ù‡Ù†Ú¯Ø§Ù… Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && input.value.length === 0 && index > 0) {
                        inputs[index - 1].focus();
                        inputs[index - 1].value = ''; 
                    }
                });
            });
        }
        
        // ------------------------------------
        // ØªÙˆØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ù„Ø§Ú¯ÛŒÙ†
        // ------------------------------------

        /** Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ø¯ ØªØ£ÛŒÛŒØ¯ (Ù…Ø±Ø­Ù„Ù‡ Û±) */
        async function sendVerificationCode(resend = false) {
            const phoneInput = document.getElementById('phone');
            const sendCodeBtn = document.getElementById('send-code-btn');
            const resendLink = document.getElementById('resend-link');
            
            const phone = phoneInput.value.trim();
            currentPhone = phone; 

            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
            if (!/^09\d{9}$/.test(phone)) {
                showStatus("âŒ Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ù…Ø¹ØªØ¨Ø± (Ù…Ø§Ù†Ù†Ø¯ 09123456789) ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.", 'error');
                return;
            }

            // Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª
            sendCodeBtn.disabled = true;
            if (resend) {
                showStatus("ğŸ” Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯ Ú©Ø¯...", 'info');
                resendLink.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯...';
            } else {
                sendCodeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯...';
                showStatus("ğŸ“ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯ ØªØ£ÛŒÛŒØ¯ Ø¨Ù‡ Ø´Ù…Ø§Ø±Ù‡ " + phone + "...", 'info');
            }
            
            try {
                const response = await fetch("/send_code", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ phone: phone })
                });

                const data = await response.json();
                
                if (response.ok && data.status === "success") {
                    showStatus("âœ… Ú©Ø¯ ØªØ£ÛŒÛŒØ¯ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¢Ù† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.", 'success');
                    
                    // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ù…Ø±Ø­Ù„Ù‡ ØªØ£ÛŒÛŒØ¯
                    document.getElementById('phone-form').style.display = 'none';
                    document.getElementById('verify-form').style.display = 'block';
                    document.getElementById('sent-to-phone').innerText = phone;
                    
                    startTimer(); // Ø´Ø±ÙˆØ¹ ØªØ§ÛŒÙ…Ø±
                    document.getElementById('code1').focus(); // ØªÙ…Ø±Ú©Ø² Ø±ÙˆÛŒ Ø§ÙˆÙ„ÛŒÙ† ÙÛŒÙ„Ø¯
                    
                } else {
                    showStatus("âŒ " + data.message, 'error');
                    // Ø¨Ø±Ú¯Ø´ØªÙ† Ø¯Ú©Ù…Ù‡ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§
                    sendCodeBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ø¯ ØªØ£ÛŒÛŒØ¯';
                    sendCodeBtn.disabled = false;
                }

            } catch (e) {
                console.error("Fetch Error:", e);
                showStatus("âš ï¸ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ ÛŒØ§ Ø³Ø±ÙˆØ± Ø±Ø® Ø¯Ø§Ø¯. Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.", 'error');
                sendCodeBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ø¯ ØªØ£ÛŒÛŒØ¯';
                sendCodeBtn.disabled = false;
            } finally {
                // Ø§Ú¯Ø± ÙØ±Ù… ØªØ£ÛŒÛŒØ¯ Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù‡ Ù†Ø´Ø¯ØŒ Ø¯Ú©Ù…Ù‡ ÙØ¹Ø§Ù„ Ø¨Ù…Ø§Ù†Ø¯
                if (document.getElementById('verify-form').style.display === 'none') {
                    sendCodeBtn.disabled = false;
                }
            }
        }

        /** Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯ Ú©Ø¯ */
        function resendCode(e) {
            e.preventDefault();
            // Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ú©Ø¯ Ù‚Ø¨Ù„ Ø§Ø² Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯
            document.querySelectorAll('.code-input').forEach(input => input.value = '');
            sendVerificationCode(true);
        }

        /** Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ Ø´Ù…Ø§Ø±Ù‡ */
        function goBackToPhoneInput(e) {
            e.preventDefault();
            clearInterval(timerInterval); 
            showStatus('Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ø¬Ø¯ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ Ùˆ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ø¯ Ø¯Ù‡ÛŒØ¯.', 'info');
            document.getElementById('phone-form').style.display = 'block';
            document.getElementById('verify-form').style.display = 'none';
            document.getElementById('send-code-btn').innerHTML = '<i class="fas fa-paper-plane"></i> Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ø¯ ØªØ£ÛŒÛŒØ¯';
            document.getElementById('send-code-btn').disabled = false;
            document.getElementById('phone').focus();
        }

        /** ØªØ£ÛŒÛŒØ¯ Ú©Ø¯ Ù¾ÛŒØ§Ù…Ú©ÛŒ (Ù…Ø±Ø­Ù„Ù‡ Û²) */
        async function verifyCode() {
            const verifyBtn = document.getElementById('verify-btn');
            const codeInputs = document.querySelectorAll('.code-input');
            const code = Array.from(codeInputs).map(input => input.value).join('');

            // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
            if (code.length !== 6) {
                showStatus("âŒ Ù„Ø·ÙØ§Ù‹ Ú©Ø¯ ØªØ£ÛŒÛŒØ¯ Û¶ Ø±Ù‚Ù…ÛŒ Ø±Ø§ Ú©Ø§Ù…Ù„ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.", 'error');
                return;
            }

            // Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª
            verifyBtn.disabled = true;
            verifyBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¯Ø± Ø­Ø§Ù„ ØªØ£ÛŒÛŒØ¯...';
            showStatus("ğŸ” Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø¯ ØªØ£ÛŒÛŒØ¯...", 'info');

            try {
                const response = await fetch("/verify_code", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ phone: currentPhone, code: code })
                });

                const data = await response.json();
                
                if (response.ok && data.status === "success") {
                    showStatus("ğŸ‰ ØªØ¨Ø±ÛŒÚ©! ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚ÛŒØª Ø¢Ù…ÛŒØ². Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ù¾Ù†Ù„ Ú©Ø§Ø±Ø¨Ø±ÛŒ...", 'success');
                    clearInterval(timerInterval);
                    // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ
                    setTimeout(() => {
                        // ÙØ±Ø¶ Ø¨Ø± Ø§ÛŒÙ† Ø§Ø³Øª Ú©Ù‡ API Ù…Ø³ÛŒØ± Ø§Ù†ØªÙ‚Ø§Ù„ Ø±Ø§ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯
                        window.location.href = data.redirect_url || "/account"; 
                    }, 1500);

                } else {
                    showStatus("âŒ " + data.message, 'error');
                    verifyBtn.innerHTML = '<i class="fas fa-check-circle"></i> ØªØ£ÛŒÛŒØ¯ Ùˆ ÙˆØ±ÙˆØ¯';
                    // ÙØ¹Ø§Ù„ Ù…Ø§Ù†Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ø§ÛŒ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯
                    verifyBtn.disabled = false;
                }

            } catch (e) {
                console.error("Fetch Error:", e);
                showStatus("âš ï¸ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ ÛŒØ§ Ø³Ø±ÙˆØ± Ø±Ø® Ø¯Ø§Ø¯. Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.", 'error');
                verifyBtn.innerHTML = '<i class="fas fa-check-circle"></i> ØªØ£ÛŒÛŒØ¯ Ùˆ ÙˆØ±ÙˆØ¯';
            } finally {
                verifyBtn.disabled = false;
            }
        }
        
        // ------------------------------------
        // Ø§Ø¬Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        // ------------------------------------
        document.addEventListener('DOMContentLoaded', () => {
            setupCodeInputs();
            const urlParams = new URLSearchParams(window.location.search);
            const redirectParam = urlParams.get('next');
            if (redirectParam) {
                showStatus(`âš ï¸ Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ù‡ ${decodeURIComponent(redirectParam)}ØŒ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯.`, 'info');
            } else {
                showStatus('Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.', 'info');
            }
        });
    </script>

</body>
</html>