<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙˆØ±ÙˆØ¯/Ø«Ø¨Øª Ù†Ø§Ù… Ø¨Ø§ Ø§ÛŒÙ…ÛŒÙ„</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø±Ù†Ú¯ */
        :root {
            --bg-dark: #070707; 
            --card-dark: #1e1e1e; 
            --highlight-color: #03A9F4; /* Ø±Ù†Ú¯ Ø¢Ø¨ÛŒ Ø¬Ø°Ø§Ø¨ */
            --highlight-color-light: #4cbbff;
            --bazaar-color: #007a37; /* Ø±Ù†Ú¯ Ø³Ø¨Ø² Ú©Ø§ÙÙ‡â€ŒØ¨Ø§Ø²Ø§Ø± */
            --text-color: #FAFAFA; 
            --error-color: #FF4444; 
            --success-color: #00CC66;
            --border-radius: 12px;
        }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Vazirmatn', sans-serif;}
        body { 
            background: var(--bg-dark); 
            color: var(--text-color); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            padding: 20px;
        }
        
        /* ğŸ’¥ Ø§Ø³ØªØ§ÛŒÙ„ Ú©Ø§Ø±Øª Ø¨Ø§ Ø³Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…ÛŒÙ‚ */
        .login-card { 
            position: relative; /* Ø¨Ø±Ø§ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒØ¯Ù‡ÛŒ Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª */
            background: var(--card-dark); 
            padding: 35px; 
            border-radius: var(--border-radius); 
            width: 90%; 
            max-width: 400px; 
            /* Ø³Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ú†Ù†Ø¯Ú¯Ø§Ù†Ù‡ Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù‚ */
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.6), /* Ø³Ø§ÛŒÙ‡ ØªØ§Ø±ÛŒÚ©â€ŒØªØ± */
                0 0 0 1px rgba(255, 255, 255, 0.05); /* Ø­Ø§Ø´ÛŒÙ‡ Ø¯Ø§Ø®Ù„ÛŒ Ø¸Ø±ÛŒÙ */
            direction: rtl;
            transform: scale(1);
            transition: transform 0.3s ease-in-out;
        }

        .login-card:hover {
            transform: scale(1.01); /* Ø§ÙÚ©Øª Ú©ÙˆÚ†Ú© Ù‡Ø§ÙˆØ± Ø±ÙˆÛŒ Ú©Ø§Ø±Øª */
        }

        /* --- Ø§Ø³ØªØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª --- */
        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: #333;
            color: var(--text-color);
            border: none;
            width: 38px;
            height: 38px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.1rem;
            transition: background-color 0.2s, color 0.2s, transform 0.2s;
        }

        .back-button:hover {
            background-color: var(--highlight-color);
            color: var(--card-dark);
            transform: scale(1.05);
        }
        /* -------------------------------------- */


        .login-card h2 { 
            text-align: center; 
            color: var(--highlight-color); 
            margin-bottom: 30px; 
            font-size: 1.8rem;
        }
        .input-group { margin-bottom: 25px; }
        .input-group label { display: block; margin-bottom: 8px; font-size: 0.95rem; color: #aaa; }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ ÙÛŒÙ„Ø¯ Ø§ÛŒÙ…ÛŒÙ„ Ø¨Ø§ Ø¢ÛŒÚ©ÙˆÙ† Ùˆ Ø¬Ø¯Ø§Ú©Ù†Ù†Ø¯Ù‡ */
        .input-with-icon {
            display: flex;
            /* Ø§Ø³ØªØ§ÛŒÙ„ Ù…Ø±Ø² Ú©Ù…ÛŒ Ø±ÙˆØ´Ù†â€ŒØªØ± */
            border: 1px solid #3d3d3d; 
            border-radius: 10px;
            background: #2a2a2a;
            overflow: hidden;
            transition: border-color 0.3s;
            direction: ltr;
        }
        
        .input-with-icon:focus-within {
            border-color: var(--highlight-color); 
            box-shadow: 0 0 8px rgba(3, 169, 244, 0.5); /* Ø³Ø§ÛŒÙ‡ Ù†Ø¦ÙˆÙ†ÛŒ Ø¯Ø± ÙÙˆÚ©ÙˆØ³ */
        }

        .icon-wrapper {
            /* Ø¬Ø¯Ø§Ú©Ù†Ù†Ø¯Ù‡ Ø¹Ù…ÙˆØ¯ÛŒ Ù‚ÙˆÛŒâ€ŒØªØ± */
            border-right: 1px solid #3d3d3d; 
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: #222222; /* Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ù…ØªÙØ§ÙˆØª Ø¨Ø±Ø§ÛŒ Ø¢ÛŒÚ©ÙˆÙ† */
            color: var(--highlight-color); 
            font-size: 1.1rem;
            flex-shrink: 0; 
        }

        .input-with-icon input { 
            flex-grow: 1; 
            padding: 12px;
            border: none;
            background: #2a2a2a; 
            color: var(--text-color); 
            font-size: 1rem; 
            outline: none; 
            direction: ltr;
            text-align: left;
        }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ú©Ù…Ù‡ Ø§ØµÙ„ÛŒ (Primary Button) */
        button:not(.back-button) { /* Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØºÛŒØ± Ø§Ø² Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª */
            width: 100%; 
            padding: 14px; 
            border: none; 
            border-radius: 10px; 
            background: var(--highlight-color); 
            color: var(--bg-dark); 
            font-size: 1.15rem; 
            font-weight: 700; 
            cursor: pointer; 
            /* Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø¨Ø±Ø§ÛŒ Ù‡Ø§ÙˆØ± */
            transition: background-color 0.3s, opacity 0.3s, transform 0.2s, box-shadow 0.3s;
            box-shadow: 0 4px 15px rgba(3, 169, 244, 0.4); /* Ø³Ø§ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø¬Ø³ØªÚ¯ÛŒ */
        }
        button:not(.back-button):hover:not(:disabled) { 
            background: var(--highlight-color-light); 
            transform: translateY(-2px); /* Ú©Ù…ÛŒ Ø¨Ø§Ù„Ø§ Ø¢Ù…Ø¯Ù† Ø¯Ø± Ù‡Ø§ÙˆØ± */
            box-shadow: 0 6px 20px rgba(3, 169, 244, 0.6);
        }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø®Ø· Ø¬Ø¯Ø§Ú©Ù†Ù†Ø¯Ù‡ */
        .divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 30px 0; 
            color: #555;
            font-size: 1rem;
            font-weight: 500;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid #3d3d3d; 
        }

        .divider:not(:empty)::before {
            margin-left: .7em;
        }

        .divider:not(:empty)::after {
            margin-right: .7em;
        }

        /* ğŸ’¥ Ø§Ø³ØªØ§ÛŒÙ„ Ù„ÛŒÙ†Ú© Ø³ÙˆÛŒÛŒÚ† (Secondary Button) */
        .switch-link { 
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px; 
            padding: 12px;
            margin-bottom: 10px;
            /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ú©Ù…Ù‡ Ø¨Ø§ Ø­Ø§Ø´ÛŒÙ‡ Ø¢Ø¨ÛŒ */
            border: 2px solid var(--highlight-color); 
            border-radius: 10px;
            background: transparent; 
            color: var(--highlight-color); 
            text-decoration: none; 
            font-size: 1.05rem; 
            font-weight: 700;
            transition: background-color 0.3s, color 0.3s, transform 0.2s;
        }

        .switch-link:hover {
            background: var(--highlight-color); /* ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ Ø¨Ù‡ Ø¢Ø¨ÛŒ */
            color: var(--bg-dark); /* ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ Ù…ØªÙ† Ø¨Ù‡ ØªÛŒØ±Ù‡ */
            transform: translateY(-1px);
        }

        /* ğŸŸ¢ Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ø§Ø± */
        .bazaar-btn {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px; 
            padding: 12px;
            border-radius: 10px;
            background: var(--bazaar-color);
            color: white;
            text-decoration: none;
            font-size: 1.05rem;
            font-weight: 700;
            transition: opacity 0.3s, transform 0.2s;
            box-shadow: 0 4px 10px rgba(0, 122, 55, 0.3);
        }

        .bazaar-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .status-message { margin-top: 20px; padding: 10px; border-radius: 8px; text-align: center; }
        .status-message.error { background: rgba(255, 68, 68, 0.2); color: var(--error-color); }
        .status-message.success { background: rgba(0, 204, 102, 0.2); color: var(--success-color); }
        
        /* --- Ø§Ø³ØªØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù…ØªÙ† Ù¾Ø°ÛŒØ±Ø´ Ø´Ø±Ø§ÛŒØ· --- */
        .terms-acceptance {
            text-align: center;
            margin-top: 25px; /* ÙØ§ØµÙ„Ù‡ Ø§Ø² Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ù„Ø§ */
            font-size: 0.9rem;
            color: #999;
            line-height: 1.6;
        }

        .terms-acceptance .policy-link {
            color: var(--highlight-color); /* Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ù†Ú¯ Ø¢Ø¨ÛŒ */
            text-decoration: none; /* Ø­Ø°Ù Ø²ÛŒØ±Ø®Ø· Ù¾ÛŒØ´ ÙØ±Ø¶ Ù…Ø±ÙˆØ±Ú¯Ø± */
            font-weight: 700;
            transition: color 0.2s;
        }

        .terms-acceptance .policy-link:hover {
            color: var(--highlight-color-light); 
            text-decoration: underline;
        }
        
        .terms-acceptance .fas {
            margin-left: 5px;
            color: var(--success-color); /* Ø¢ÛŒÚ©ÙˆÙ† ØªÛŒÚ© Ø³Ø¨Ø² */
        }
        /* ------------------------------------------- */
    </style>
</head>
<body>

<div class="login-card">
    
    <button class="back-button" onclick="history.back()">
        <i class="fas fa-arrow-right"></i> </button>
    
    <h2><i class="fas fa-envelope-open-text"></i> ÙˆØ±ÙˆØ¯ ÛŒØ§ Ø«Ø¨Øª Ù†Ø§Ù…</h2>
    <div class="input-group">
        <label for="email">Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„</label>
        
        <div class="input-with-icon">
            <span class="icon-wrapper">
                <i class="fas fa-at"></i> </span>
            <input type="email" id="email" placeholder="Ù…Ø«Ù„Ø§Ù‹: yourname@gmail.com" required>
        </div>

    </div>
    
    <button id="send-code-btn" onclick="sendCode()">
        <i class="fas fa-paper-plane"></i> Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ø¯ ØªØ£ÛŒÛŒØ¯
    </button>
    
    <div id="status-message" class="status-message" style="display:none;"></div>

    <div class="divider">ÛŒØ§</div>
    
    <a href="/login_phone" class="switch-link">
        <i class="fas fa-mobile-alt"></i> 
        ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†
    </a>

    <a href="/bazaar_login" class="bazaar-btn">
        <i class="fas fa-shopping-bag"></i>
        ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ø²Ø§Ø±
    </a>
    
    <p class="terms-acceptance">
        <i class="fas fa-check-circle"></i>
        Ù…Ù† 
        <a href="{{ url_for('terms_of_service') }}" class="policy-link">Ø´Ø±Ø§ÛŒØ· Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø®Ø¯Ù…Ø§Øª</a> 
        Ùˆ 
        <a href="{{ url_for('privacy_policy') }}" class="policy-link">Ø­Ø±ÛŒÙ… Ø®ØµÙˆØµÛŒ</a> 
        Ø±Ø§ Ù…ÛŒ Ù¾Ø°ÛŒØ±Ù….
    </p>
    
</div>

<script>
    const emailInput = document.getElementById('email');
    const sendCodeBtn = document.getElementById('send-code-btn');
    const statusDiv = document.getElementById('status-message');

    // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… ÙˆØ¶Ø¹ÛŒØª (Ù…ÙˆÙÙ‚ÛŒØªØŒ Ø®Ø·Ø§ØŒ Ù‡Ø´Ø¯Ø§Ø±)
    function showStatus(message, type) {
        statusDiv.textContent = message;
        statusDiv.className = 'status-message ' + type;
        statusDiv.style.display = 'block';
    }

    // ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯
    async function sendCode() {
        const email = emailInput.value.trim();
        if (!email) {
            showStatus("Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.", 'error');
            return;
        }

        sendCodeBtn.disabled = true;
        sendCodeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯...';
        showStatus("Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯ Ø¨Ù‡ Ø§ÛŒÙ…ÛŒÙ„ Ø´Ù…Ø§...", 'success');

        try {
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Flask API
            const response = await fetch("/send_code", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email: email })
            });

            const data = await response.json();
            
            if (response.ok && data.status === "success") {
                showStatus("âœ… " + data.message + " Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†ØªÙ‚Ø§Ù„...", 'success');
                // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ ØµÙØ­Ù‡ ØªØ£ÛŒÛŒØ¯ Ú©Ø¯
                setTimeout(() => {
                    window.location.href = `/verify_page?email=${encodeURIComponent(email)}`;
                }, 1500);

            } else {
                showStatus("âŒ " + data.message, 'error');
                sendCodeBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ø¯ ØªØ£ÛŒÛŒØ¯';
                sendCodeBtn.disabled = false;
            }

        } catch (e) {
            console.error("Fetch Error:", e);
            showStatus("âš ï¸ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ ÛŒØ§ Ø³Ø±ÙˆØ± Ø±Ø® Ø¯Ø§Ø¯. Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.", 'error');
            sendCodeBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ø¯ ØªØ£ÛŒÛŒØ¯';
            sendCodeBtn.disabled = false;
        }
    }
</script>

</body>
</html>