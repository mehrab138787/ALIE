<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙˆØ±ÙˆØ¯/Ø«Ø¨Øª Ù†Ø§Ù… Ø¨Ø§ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø±Ù†Ú¯ */
        :root {
            --bg-dark: #070707; 
            --card-dark: #1e1e1e; 
            --highlight-color: #03A9F4; 
            --highlight-color-light: #4cbbff;
            --text-color: #FAFAFA; 
            --error-color: #FF4444; 
            --success-color: #00CC66;
            --border-radius: 12px;
        }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Vazirmatn', sans-serif;}
        body { 
            background: var(--bg-dark); 
            color: var(--text-color); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            padding: 20px;
        }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ú©Ø§Ø±Øª Ø¨Ø§ Ø³Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…ÛŒÙ‚ Ùˆ Ø§ÙÚ©Øª Ù‡Ø§ÙˆØ± */
        .login-card { 
            background: var(--card-dark); 
            padding: 35px; 
            border-radius: 16px;
            width: 90%; 
            max-width: 400px; 
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.6), 
                0 0 0 1px rgba(255, 255, 255, 0.05);
            direction: rtl;
            transform: scale(1);
            transition: transform 0.3s ease-in-out;
            position: relative; /* Ø¨Ø±Ø§ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ù‡ÛŒ Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª */
        }

        .login-card:hover {
            transform: scale(1.01);
        }

        .login-card h2 { 
            text-align: center; 
            color: var(--highlight-color); 
            margin-bottom: 30px; 
            font-size: 1.8rem;
        }
        .input-group { margin-bottom: 25px; }
        .input-group label { display: block; margin-bottom: 8px; font-size: 0.95rem; color: #aaa; }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ú©Ø§Ù†ØªÛŒÙ†Ø± ÙÛŒÙ„Ø¯ ØªÙ„ÙÙ† (Ø´Ø§Ù…Ù„ Ú©Ø¯ Ùˆ Ø´Ù…Ø§Ø±Ù‡) */
        .phone-input-container {
            display: flex;
            border: 1px solid #3d3d3d; 
            border-radius: 10px;
            background: #2a2a2a;
            overflow: hidden;
            transition: border-color 0.3s;
            direction: ltr; 
        }
        
        .phone-input-container:focus-within {
            border-color: var(--highlight-color); 
            box-shadow: 0 0 8px rgba(3, 169, 244, 0.5); 
        }

        /* ğŸ’¥ Ø§Ø³ØªØ§ÛŒÙ„ Ù†Ù…Ø§ÛŒØ´ Ú©Ø¯ Ú©Ø´ÙˆØ± (+98 Ùˆ Ù¾Ø±Ú†Ù…) */
        .country-code-display {
            border-right: 1px solid #3d3d3d; 
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: #222222; 
            color: var(--text-color);
            font-size: 1.1rem;
            font-weight: 700;
            flex-shrink: 0; 
            direction: ltr; 
            gap: 5px; /* ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† +98 Ùˆ Ù¾Ø±Ú†Ù… */
        }
        
        /* ğŸ’¥ Ø§Ø³ØªØ§ÛŒÙ„ SVG Ù¾Ø±Ú†Ù… */
        .flag-icon svg {
            display: block;
            border-radius: 3px; 
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3); /* Ø³Ø§ÛŒÙ‡ Ú©ÙˆÚ†Ú© Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù‚ */
        }

        .phone-input-container input { 
            flex-grow: 1; 
            padding: 12px;
            border: none;
            background: #2a2a2a; 
            color: var(--text-color); 
            font-size: 1rem; 
            outline: none; 
            direction: ltr; 
            text-align: left;
        }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ú©Ù…Ù‡ Ø§ØµÙ„ÛŒ (Primary Button) */
        button { 
            width: 100%; 
            padding: 14px; 
            border: none; 
            border-radius: 10px; 
            background: var(--highlight-color); 
            color: var(--bg-dark); 
            font-size: 1.15rem; 
            font-weight: 700; 
            cursor: pointer; 
            transition: background-color 0.3s, opacity 0.3s, transform 0.2s, box-shadow 0.3s;
            box-shadow: 0 4px 15px rgba(3, 169, 244, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }
        button:hover:not(:disabled) { 
            background: var(--highlight-color-light); 
            transform: translateY(-2px); 
            box-shadow: 0 6px 20px rgba(3, 169, 244, 0.6);
        }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø®Ø· Ø¬Ø¯Ø§Ú©Ù†Ù†Ø¯Ù‡ */
        .divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 30px 0; 
            color: #555;
            font-size: 1rem;
            font-weight: 500;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid #3d3d3d; 
        }

        .divider:not(:empty)::before { margin-left: .7em; }
        .divider:not(:empty)::after { margin-right: .7em; }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ù„ÛŒÙ†Ú© Ø³ÙˆÛŒÛŒÚ† (Secondary Button) */
        .switch-link { 
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px; 
            padding: 12px;
            border: 2px solid var(--highlight-color); 
            border-radius: 10px;
            background: transparent; 
            color: var(--highlight-color); 
            text-decoration: none; 
            font-size: 1.05rem; 
            font-weight: 700;
            transition: background-color 0.3s, color 0.3s, transform 0.2s;
        }

        .switch-link:hover {
            background: var(--highlight-color); 
            color: var(--bg-dark); 
            transform: translateY(-1px);
        }
        
        .status-message { margin-top: 20px; padding: 10px; border-radius: 8px; text-align: center; }
        .status-message.error { background: rgba(255, 68, 68, 0.2); color: var(--error-color); }
        .status-message.success { background: rgba(0, 204, 102, 0.2); color: var(--success-color); }
        
        /* ğŸ†• Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª */
        .back-button {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #888;
            font-size: 1.3rem;
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .back-button:hover {
            color: var(--highlight-color-light);
        }

    </style>
</head>
<body>

<div class="login-card">
    
    <a href="/" class="back-button" title="Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¹Ù‚Ø¨">
        <i class="fas fa-arrow-right"></i>
    </a>
    
    <h2><i class="fas fa-mobile-alt"></i> ÙˆØ±ÙˆØ¯ ÛŒØ§ Ø«Ø¨Øª Ù†Ø§Ù… Ø¨Ø§ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†</h2>
    <div class="input-group">
        <label for="phone">Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† (Û±Û° Ø±Ù‚Ù…ÛŒ)</label>
        
        <div class="phone-input-container">
            <span class="country-code-display">
                +98 
                <span class="flag-icon">
                    <svg viewBox="0 0 100 60" width="24" height="18">
                        <rect width="100" height="20" fill="#23A03B"/> <rect y="20" width="100" height="20" fill="#FFFFFF"/> <rect y="40" width="100" height="20" fill="#DA0000"/> <circle cx="50" cy="30" r="4" fill="#DA0000" />
                    </svg>
                </span>
            </span>
            <input type="tel" id="phone" placeholder="9123456789" required maxlength="10">
        </div>

    </div>
    
    <button id="send-code-btn" onclick="sendCode()">
        <i class="fas fa-sms"></i> Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ø¯ ØªØ£ÛŒÛŒØ¯ Ù¾ÛŒØ§Ù…Ú©ÛŒ
    </button>
    
    <div id="status-message" class="status-message" style="display:none;"></div>

    <div class="divider">ÛŒØ§</div>
    
    <a href="/login" class="switch-link">
        <i class="fas fa-envelope-open-text"></i>
        ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ø§ÛŒÙ…ÛŒÙ„
    </a>
</div>

<script>
    const phoneInput = document.getElementById('phone');
    const sendCodeBtn = document.getElementById('send-code-btn');
    const statusDiv = document.getElementById('status-message');

    function showStatus(message, type) {
        statusDiv.textContent = message;
        statusDiv.className = 'status-message ' + type;
        statusDiv.style.display = 'block';
    }

    // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø§ÛŒÙ†Ú©Ù‡ ÙˆØ±ÙˆØ¯ÛŒ ÙÙ‚Ø· Ø§Ø¹Ø¯Ø§Ø¯ Ø¨Ø§Ø´Ø¯ Ùˆ Ø¨Ø§ 9 Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯
    phoneInput.addEventListener('input', (e) => {
        let value = e.target.value.replace(/\D/g, ''); // Ø­Ø°Ù ØºÛŒØ± Ø§Ø¹Ø¯Ø§Ø¯
        
        if (value.length > 0 && value[0] !== '9') {
            value = '9' + value.substring(1); // Ø´Ø±ÙˆØ¹ Ø¨Ø§ 9 Ø±Ø§ Ø§Ø¬Ø¨Ø§Ø±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
        }
        
        if (value.length > 10) {
            value = value.substring(0, 10);
        }
        
        e.target.value = value;
    });

    // ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯
    async function sendCode() {
        // Ù…Ø§ ÙÙ‚Ø· 10 Ø±Ù‚Ù… Ø¨Ø¹Ø¯ Ø§Ø² 98 Ø±Ø§ Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒÙ…
        const phone_suffix = phoneInput.value.trim(); 
        
        if (phone_suffix.length !== 10 || phone_suffix[0] !== '9') {
            showStatus("Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Û±Û° Ø±Ù‚Ù…ÛŒ Ù…Ø¹ØªØ¨Ø± (Ø´Ø±ÙˆØ¹ Ø¨Ø§ Û¹) ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.", 'error');
            return;
        }
        
        // ØªØ±Ú©ÛŒØ¨ Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø¨Ú©â€ŒØ§Ù†Ø¯ (Ù…Ø§Ù†Ù†Ø¯ 0912...)
        const full_phone = '0' + phone_suffix;

        sendCodeBtn.disabled = true;
        sendCodeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…Ú©...';
        showStatus("Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯ Ø¨Ù‡ Ø´Ù…Ø§Ø±Ù‡ Ø´Ù…Ø§...", 'success');

        try {
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Flask API
            const response = await fetch("/send_sms_code", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ phone: full_phone }) // Ø§Ø±Ø³Ø§Ù„ Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ù…Ù„ (Ø¨Ø§ 0)
            });

            const data = await response.json();
            
            if (response.ok && data.status === "success") {
                // Ø°Ø®ÛŒØ±Ù‡ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ú©Ø§Ù…Ù„ (Ø¨Ø§ 0) Ø¯Ø± Local Storage (Ø¨Ø±Ø§ÛŒ Ù…Ø«Ø§Ù„)
                localStorage.setItem('phone_for_verification', full_phone);
                
                showStatus("âœ… " + data.message + " Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†ØªÙ‚Ø§Ù„...", 'success');
                setTimeout(() => {
                    window.location.href = `/verify_page_phone`;
                }, 1500);

            } else {
                showStatus("âŒ " + data.message, 'error');
                sendCodeBtn.innerHTML = '<i class="fas fa-sms"></i> Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ø¯ ØªØ£ÛŒÛŒØ¯ Ù¾ÛŒØ§Ù…Ú©ÛŒ';
                sendCodeBtn.disabled = false;
            }

        } catch (e) {
            console.error("Fetch Error:", e);
            showStatus("âš ï¸ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ ÛŒØ§ Ø³Ø±ÙˆØ± Ø±Ø® Ø¯Ø§Ø¯. Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.", 'error');
            sendCodeBtn.innerHTML = '<i class="fas fa-sms"></i> Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ø¯ ØªØ£ÛŒÛŒØ¯ Ù¾ÛŒØ§Ù…Ú©ÛŒ';
            sendCodeBtn.disabled = false;
        }
    }
</script>

</body>
</html>