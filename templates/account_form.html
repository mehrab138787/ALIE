<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ØªÚ©Ù…ÛŒÙ„ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ - Cyrus AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* ======================================================= */
        /* ğŸ¨ Variables (Glass, Electric Blue)                     */
        /* ======================================================= */
        :root {
            --app-height: 100vh;
            --bg-dark: #070707; 
            --card-dark: rgba(28, 28, 28, 0.9);
            --accent-color: #1a1a1a;
            --highlight-color: #03A9F4; 
            --text-color: #FAFAFA;
            --muted-text: #999999;
            --border-radius: 15px; 
            --neum-dark: rgba(0, 0, 0, 0.9);
            --neum-light: rgba(255, 255, 255, 0.05); 
            --success-color: #4CAF50;
        }

        /* ======================================================= */
        /* ğŸŒ Global & Layout                                       */
        /* ======================================================= */
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family:'Vazirmatn', sans-serif;
            background: var(--bg-dark);
            color: var(--text-color);
            width: 100vw; height: var(--app-height); overflow-x: hidden;
            display: flex; justify-content: center; align-items: flex-start;
        }

        #page-container {
            width: 100%; height: var(--app-height); max-width: 100%;
            display: flex; flex-direction: column;
            background: var(--card-dark);
            backdrop-filter: blur(10px); 
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            position: relative;
            overflow-y: auto;
            /* âœ… ÙØ¶Ø§ÛŒ Ø®Ø§Ù„ÛŒ Ø¨Ø±Ø§ÛŒ ÙÙˆØªØ± Ø«Ø§Ø¨Øª */
            padding-bottom: 50px; 
        }
        
        @media (max-width: 600px) {
            #page-container { 
                padding-top: 55px;
                padding-bottom: 45px; /* ØªÙ†Ø¸ÛŒÙ… Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ */
            }
        }
        @media (min-width: 601px) {
            #page-container { padding-top: 65px; } 
        }
        
        /* ======================================================= */
        /* â¬†ï¸ Header (Fixed Top)                                  */
        /* ======================================================= */
        #page-header {
            position: fixed; top: 0; left: 0; right: 0;
            padding: 15px 20px; background: var(--bg-dark); 
            color: var(--text-color); text-align: right; 
            font-size: 1.6rem; font-weight: 700;
            border-bottom: 3px solid var(--highlight-color);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.7);
            z-index: 50; display: flex; align-items: center; direction: rtl;
        }
        
        #back-btn {
            background: transparent; border: none;
            color: var(--highlight-color); font-size: 1.5rem;
            margin-left: 15px; cursor: pointer; 
            transition: color 0.2s, transform 0.2s ease;
        }
        #back-btn:hover { color: #FFF; }
        #back-btn:active { transform: scale(0.9); }

        /* ======================================================= */
        /* ğŸ’¬ Content & Card Styles                                */
        /* ======================================================= */
        #content {
            flex: 1; padding: 30px; direction: rtl; line-height: 1.8;
            background: rgba(0, 0, 0, 0.2); 
            min-height: calc(var(--app-height) - 75px);
        }
        #content h1 {
            color: var(--highlight-color);
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 0 0 8px rgba(3, 169, 244, 0.5);
        }

        .card {
            background: var(--accent-color);
            padding: 25px; border-radius: var(--border-radius);
            margin-bottom: 25px;
            box-shadow: 8px 8px 16px var(--neum-dark), -8px -8px 16px var(--neum-light);
            border-right: 5px solid var(--highlight-color);
        }
        
        .card h3 {
            color: var(--highlight-color); margin-bottom: 25px;
            font-weight: 700; font-size: 1.7rem;
            text-align: center;
            border-bottom: 1px dashed var(--muted-text);
            padding-bottom: 10px;
        }

        /* ------------------ ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ÛŒ ÙØ±Ù… ------------------ */
        .profile-form input[type="text"], 
        .profile-form input[type="email"],
        .profile-form input[type="hidden"] {
            width: 100%; padding: 15px 20px; margin-bottom: 20px;
            border-radius: 10px; border: none;
            background: var(--bg-dark); 
            color: var(--text-color);
            font-family: 'Vazirmatn', sans-serif;
            font-size: 1.05rem;
            direction: rtl;
            outline: none;
            box-shadow: inset 4px 4px 8px var(--neum-dark), inset -4px -4px 8px var(--neum-light);
            transition: box-shadow 0.3s ease;
        }
        .profile-form input:focus {
            box-shadow: inset 0 0 10px var(--highlight-color), 4px 4px 8px var(--neum-dark);
            border: 1px solid var(--highlight-color);
        }
        
        /* ğŸ’¡ Ø§Ø³ØªØ§ÛŒÙ„ ÙÛŒÙ„Ø¯ ØºÛŒØ±ÙØ¹Ø§Ù„ */
        .profile-form input[disabled] {
            color: #666; 
            background: var(--accent-color);
            box-shadow: none;
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* ------------------ Ø¯Ú©Ù…Ù‡ Ø°Ø®ÛŒØ±Ù‡ ------------------ */
        .profile-form button, .modal .save-button {
            background: var(--success-color);
            color: white; border: none; padding: 18px;
            border-radius: 10px; cursor: pointer;
            font-weight: 700; width: 100%;
            font-size: 1.2rem;
            transition: all 0.2s ease;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
            margin-top: 15px;
        }
        .profile-form button:hover, .modal .save-button:hover { 
            background: #388E3C; 
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.6);
        }
        .profile-form button:active, .modal .save-button:active { 
            transform: scale(0.98); 
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.5);
        }

        /* ======================================================= */
        /* â¬‡ï¸ Footer (Fixed Bottom)                               */
        /* ======================================================= */
        #page-footer {
            position: fixed; /* âœ… Ø«Ø§Ø¨Øª Ù†Ú¯Ù‡ Ø¯Ø§Ø´ØªÙ† */
            bottom: 0; left: 0; right: 0;
            padding: 10px; 
            background: var(--bg-dark);
            text-align: center; 
            font-size: 0.85rem;
            color: var(--muted-text); 
            border-top: 1px solid var(--highlight-color); 
            box-shadow: 0 -5px 10px rgba(0, 0, 0, 0.5);
            z-index: 100;
        }

        /* ======================================================= */
        /* ğŸ“± Mobile Adjustments                                   */
        /* ======================================================= */
        @media (max-width: 600px) {
            #content { padding: 20px; }
            .card { padding: 20px; }
            .profile-form input[type="text"], .profile-form input[type="email"], .scroller-trigger { 
                padding: 12px 15px; font-size: 0.95rem; margin-bottom: 15px; 
            }
            .profile-form button { padding: 15px; font-size: 1.1rem; }
            #page-footer { padding: 8px; font-size: 0.75rem; }
        }

        /* ======================================================= */
        /* ğŸ“… Scroller Date Picker Styles (Spinner)                */
        /* ======================================================= */

        /* ğŸ’¡ Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ú©Ù…Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ù…ÙˆØ¯Ø§Ù„ Ø±Ø§ Ø¨Ø§Ø² Ù…ÛŒâ€ŒÚ©Ù†Ø¯ */
        .scroller-trigger {
            width: 100%; padding: 15px 20px; margin-bottom: 20px;
            border-radius: 10px; border: none;
            background: var(--bg-dark); 
            color: var(--muted-text); /* Ø±Ù†Ú¯ Ù…ØªÙ† Ù¾ÛŒØ´â€ŒÙØ±Ø¶ */
            font-family: 'Vazirmatn', sans-serif;
            font-size: 1.05rem;
            direction: rtl;
            outline: none;
            cursor: pointer;
            box-shadow: inset 4px 4px 8px var(--neum-dark), inset -4px -4px 8px var(--neum-light);
            transition: all 0.2s ease;
            text-align: right;
        }

        .scroller-trigger:hover {
            color: var(--highlight-color);
            box-shadow: inset 0 0 10px var(--highlight-color), 4px 4px 8px var(--neum-dark);
        }

        .scroller-trigger i {
            margin-left: 10px;
            color: var(--highlight-color);
        }

        /* ------------------ Modal ------------------ */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            z-index: 10000;
            display: none; /* Ù…Ø®ÙÛŒ Ø¨ÙˆØ¯Ù† Ø§ÙˆÙ„ÛŒÙ‡ */
            justify-content: center; align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .modal.open { display: flex; opacity: 1; }

        .modal-content {
            background: var(--card-dark);
            border-radius: var(--border-radius);
            padding: 20px;
            width: 90%; max-width: 450px;
            box-shadow: 0 10px 40px rgba(3, 169, 244, 0.5); /* Ø³Ø§ÛŒÙ‡ Ù†Ø¦ÙˆÙ†ÛŒ */
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .modal.open .modal-content { transform: scale(1); }

        .modal-header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--accent-color);
            padding-bottom: 15px; margin-bottom: 15px;
        }
        .modal-header h3 { 
            color: var(--highlight-color); 
            font-size: 1.4rem; 
            margin: 0; /* Ø¨Ø±Ø§ÛŒ ÙÛŒÚ©Ø³ Ø´Ø¯Ù† Ø¯Ø± ÙÙ„Ú©Ø³ */
        }
        #modal-close-btn { 
            background: none; border: none; color: var(--muted-text); font-size: 1.5rem; cursor: pointer;
            transition: color 0.2s;
        }
        #modal-close-btn:hover { color: #FFF; }

        .modal .save-button {
            margin-top: 20px;
        }

        /* ------------------ Scrollers ------------------ */
        .scroller-wrapper {
            display: flex; justify-content: space-between;
            height: 180px; /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ 3 Ø¢ÛŒØªÙ… (180px / 3 = 60px) */
            overflow: hidden;
            position: relative;
            border: 1px solid var(--accent-color);
            border-radius: 10px;
            background: var(--bg-dark);
            direction: ltr; /* Ù…Ø­ØªÙˆÛŒØ§Øª Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ø§ÛŒØ¯ Ú†Ù¾ Ø¨Ù‡ Ø±Ø§Ø³Øª Ø¨Ø§Ø´Ø¯ */
        }
        
        /* Ø®Ø· ÙˆØ³Ø· Ø¨Ø±Ø§ÛŒ Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù† Ø¢ÛŒØªÙ… Ù…Ù†ØªØ®Ø¨ */
        .scroller-wrapper::before,
        .scroller-wrapper::after {
            content: '';
            position: absolute;
            left: 0; right: 0;
            height: 60px; /* (180px - 60px) / 2 = 60px Ø§Ø² Ø¨Ø§Ù„Ø§ Ùˆ 60px Ø§Ø² Ù¾Ø§ÛŒÛŒÙ† */
            z-index: 1;
            pointer-events: none;
        }
        /* Ø§ÙÚ©Øª Ù…Ø­Ùˆ Ø´Ø¯Ú¯ÛŒ Ø¨Ø§Ù„Ø§ Ùˆ Ù¾Ø§ÛŒÛŒÙ† (Ø¨Ø±Ø§ÛŒ Ø²ÛŒØ¨Ø§ÛŒÛŒ Ø¨ÛŒØ´ØªØ± Ø§Ø² Ø­Ø§Ù„Øª Gradient) */
        .scroller-wrapper::before {
            top: 0;
            background: linear-gradient(to bottom, var(--bg-dark), rgba(7, 7, 7, 0));
        }
        .scroller-wrapper::after {
            bottom: 0;
            background: linear-gradient(to top, var(--bg-dark), rgba(7, 7, 7, 0));
        }
        
        /* Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ù†Ø¦ÙˆÙ†ÛŒ Ø¢ÛŒØªÙ… Ù…Ø±Ú©Ø²ÛŒ */
        .scroller-wrapper::before {
            top: 60px; /* Ø´Ø±ÙˆØ¹ Ø§Ø² Ø¨Ø§Ù„Ø§ÛŒ Ø¢ÛŒØªÙ… Ù…Ø±Ú©Ø²ÛŒ */
            height: 60px;
            background: rgba(3, 169, 244, 0.1);
            border-top: 1px solid rgba(3, 169, 244, 0.5);
            border-bottom: 1px solid rgba(3, 169, 244, 0.5);
            z-index: 0;
        }
        
        .scroller-column {
            flex: 1;
            overflow-y: scroll;
            padding: 0 5px;
            scroll-snap-type: y mandatory; /* Ø¨Ø±Ø§ÛŒ Ù‚ÙÙ„ Ø´Ø¯Ù† Ø±ÙˆÛŒ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ */
            text-align: center;
            border-left: 1px solid var(--accent-color);
            /* Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù†ÙˆØ§Ø± Ø§Ø³Ú©Ø±ÙˆÙ„ */
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        .scroller-column:last-child { border-left: none; }
        .scroller-column::-webkit-scrollbar { display: none; }

        .scroller-item {
            height: 60px; /* Ø§Ø±ØªÙØ§Ø¹ Ù‡Ø± Ø¢ÛŒØªÙ… */
            line-height: 60px;
            font-size: 1.3rem;
            font-weight: 500;
            color: var(--muted-text);
            scroll-snap-align: center; /* Ù‚ÙÙ„ Ø´Ø¯Ù† Ø¯Ø± Ù…Ø±Ú©Ø² Ø§Ø³Ú©Ø±ÙˆÙ„ */
            transition: all 0.1s ease;
        }

        /* ğŸ’¡ Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ø¢ÛŒØªÙ… Ù…Ø±Ú©Ø²ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ */
        .scroller-item.selected {
            color: var(--highlight-color);
            font-weight: 900;
            font-size: 1.8rem;
            /* text-shadow: 0 0 5px var(--highlight-color); */
        }
    </style>
</head>
<body>

    <div id="page-container">
        <div id="page-header">
            <button id="back-btn" onclick="window.history.back()" title="Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ú†Øª"><i class="fas fa-arrow-right"></i></button>
            <span id="page-title">ØªÚ©Ù…ÛŒÙ„ Ù¾Ø±ÙˆÙØ§ÛŒÙ„</span>
        </div>

        <div id="content">
            <h1>âœï¸ ØªÚ©Ù…ÛŒÙ„ Ù…Ø´Ø®ØµØ§Øª ÙØ±Ø¯ÛŒ</h1>
            
            <p style="text-align: center; color: var(--highlight-color); margin-bottom: 30px; font-weight: 500;">
                ØªØ¨Ø±ÛŒÚ©! Ø¬ÛŒÙ…ÛŒÙ„ Ø´Ù…Ø§ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²ÛŒØ± Ø±Ø§ Ø¬Ù‡Øª ØªÚ©Ù…ÛŒÙ„ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø®ÙˆØ¯ ÙˆØ§Ø±Ø¯ Ù†Ù…Ø§ÛŒÛŒØ¯.
            </p>

            <div class="card profile-form">
                <h3>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­Ø³Ø§Ø¨</h3>
                <form action="/complete_profile" method="POST">
                    <input type="email" value="{{ user_data.email }}" disabled>
                    <input type="text" name="first_name" placeholder="Ù†Ø§Ù…" required>
                    <input type="text" name="last_name" placeholder="Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ" required>
                    
                    <div class="date-selector-container">
                        <div id="dob-display" class="scroller-trigger" required>
                            <i class="fas fa-calendar-alt"></i> ØªØ§Ø±ÛŒØ® ØªÙˆÙ„Ø¯ (Ù…ÛŒÙ„Ø§Ø¯ÛŒ)
                        </div>
                        <input type="hidden" name="dob" id="dob_hidden" required> 
                    </div>
                    
                    <input type="text" name="profession" placeholder="Ø­Ø±ÙÙ‡ (Ù…Ø«Ù„Ø§Ù‹: ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ØŒ Ø¯Ø§Ù†Ø´Ø¬ÙˆØŒ Ø¢Ø²Ø§Ø¯Ú©Ø§Ø±)" required>
                    
                    <button type="submit"><i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡ Ùˆ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø­Ø³Ø§Ø¨</button>
                </form>
            </div>
            
        </div>
        
    </div>
    
    <div id="page-footer">
        Â© 2025 Cyrus AI. ØªÙ…Ø§Ù…ÛŒ Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª.
    </div>

    <div id="date-picker-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="direction: rtl;">Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§Ø±ÛŒØ® ØªÙˆÙ„Ø¯</h3>
                <button id="modal-close-btn" title="Ø¨Ø³ØªÙ†"><i class="fas fa-times"></i></button>
            </div>
            <div class="scroller-wrapper">
                <div class="scroller-column" id="year-scroller"></div>
                <div class="scroller-column" id="month-scroller"></div>
                <div class="scroller-column" id="day-scroller"></div>
            </div>
            <button id="modal-save-btn" class="save-button"><i class="fas fa-check"></i> ØªØ£ÛŒÛŒØ¯ Ùˆ Ø°Ø®ÛŒØ±Ù‡</button>
        </div>
    </div>

    <script>
        /* ======================================================= */
        /* ğŸ’¡ ØªÙ†Ø¸ÛŒÙ… Ø§Ø±ØªÙØ§Ø¹ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ùˆ Ù…Ù†Ø·Ù‚ Ú†Ø±Ø®Ø´ÛŒ Ø¬Ø§ÙˆØ§ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª     */
        /* ======================================================= */
        
        // ØªÙ†Ø¸ÛŒÙ… Ø§Ø±ØªÙØ§Ø¹ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„
        function setAppHeight() {
            document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
        }
        window.addEventListener('resize', setAppHeight);
        window.addEventListener('orientationchange', setAppHeight);
        setAppHeight();

        
        const YEAR_START = 1940;
        const YEAR_END = new Date().getFullYear(); 
        const ITEM_HEIGHT = 60; // Ø§Ø±ØªÙØ§Ø¹ Ø¢ÛŒØªÙ… Ø§Ø² CSS
        
        const dobDisplay = document.getElementById('dob-display');
        const dobHidden = document.getElementById('dob_hidden');
        const modal = document.getElementById('date-picker-modal');
        const closeBtn = document.getElementById('modal-close-btn');
        const saveBtn = document.getElementById('modal-save-btn');
        const yearScroller = document.getElementById('year-scroller');
        const monthScroller = document.getElementById('month-scroller');
        const dayScroller = document.getElementById('day-scroller');

        // ØªØ§Ø±ÛŒØ® Ø§ÙˆÙ„ÛŒÙ‡ (Ù…Ø«Ù„Ø§Ù‹ Ø³Ø§Ù„ 2000 Ù…ÛŒÙ„Ø§Ø¯ÛŒ)
        let selectedDate = { year: 2000, month: 1, day: 1 }; 

        // Ù†Ø§Ù… Ù…Ø§Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ Ù…ÛŒÙ„Ø§Ø¯ÛŒ
        const MONTHS = [
            { name: 'January', days: 31 }, { name: 'February', days: 28 }, 
            { name: 'March', days: 31 }, { name: 'April', days: 30 }, 
            { name: 'May', days: 31 }, { name: 'June', days: 30 }, 
            { name: 'July', days: 31 }, { name: 'August', days: 31 }, 
            { name: 'September', days: 30 }, { name: 'October', days: 31 }, 
            { name: 'November', days: 30 }, { name: 'December', days: 31 }
        ];

        /* ------------------ ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ------------------ */

        // Ú†Ú© Ú©Ø±Ø¯Ù† Ø³Ø§Ù„ Ú©Ø¨ÛŒØ³Ù‡
        function isLeap(year) {
            return (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;
        }

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…Ø§Ù‡ Ø¬Ø§Ø±ÛŒ (Ø¨Ø±Ø§ÛŒ ÙÙˆØ±ÛŒÙ‡ Ùˆ Ù…Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Û³Û° Ø±ÙˆØ²Ù‡)
        function updateDayScroller() {
            let daysInMonth = MONTHS[selectedDate.month - 1].days;
            if (selectedDate.month === 2) { // ÙÙˆØ±ÛŒÙ‡
                daysInMonth = isLeap(selectedDate.year) ? 29 : 28;
            }

            // Ø§Ú¯Ø± Ø±ÙˆØ² Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø§Ø² Ø­Ø¯Ø§Ú©Ø«Ø± Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…Ø§Ù‡ Ø¨ÛŒØ´ØªØ± Ø§Ø³ØªØŒ Ø¢Ù† Ø±Ø§ Ø§ØµÙ„Ø§Ø­ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
            if (selectedDate.day > daysInMonth) {
                selectedDate.day = daysInMonth;
            }

            dayScroller.innerHTML = '';
            
            // Ø§ÙØ²ÙˆØ¯Ù† 2 Ø¢ÛŒØªÙ… Ø®Ø§Ù„ÛŒ Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ Ùˆ Ø§Ù†ØªÙ‡Ø§ Ø¨Ø±Ø§ÛŒ ØªÙ…Ø±Ú©Ø² Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø¯Ø± Ù…Ø±Ú©Ø²
            dayScroller.appendChild(createEmptyItem());
            dayScroller.appendChild(createEmptyItem());

            for (let i = 1; i <= daysInMonth; i++) {
                const item = createScrollerItem(i);
                dayScroller.appendChild(item);
            }
            
            dayScroller.appendChild(createEmptyItem());
            dayScroller.appendChild(createEmptyItem());

            // Ù†Ù…Ø§ÛŒØ´ Ø¢ÛŒØªÙ… Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ù¾Ø³ Ø§Ø² Ø¢Ù¾Ø¯ÛŒØª
            syncSelection(dayScroller, selectedDate.day);
            // Ø§Ø³Ú©Ø±ÙˆÙ„ Ù…Ø¬Ø¯Ø¯ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª ØµØ­ÛŒØ­ (Ú†ÙˆÙ† DOM ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡)
            scrollToItem(dayScroller, selectedDate.day - 1, false); 
        }

        // Ø³Ø§Ø®Øª ÛŒÚ© Ø¢ÛŒØªÙ… (Ø±ÙˆØ²ØŒ Ù…Ø§Ù‡ ÛŒØ§ Ø³Ø§Ù„)
        function createScrollerItem(value, label = value) {
            const item = document.createElement('div');
            item.classList.add('scroller-item');
            item.dataset.value = value;
            item.textContent = label;
            return item;
        }

        // Ø³Ø§Ø®Øª Ø¢ÛŒØªÙ… Ø®Ø§Ù„ÛŒ (Ø¨Ø±Ø§ÛŒ ÙØ¶Ø§ÛŒ Ø¨Ø§Ù„Ø§ Ùˆ Ù¾Ø§ÛŒÛŒÙ†)
        function createEmptyItem() {
            const item = document.createElement('div');
            item.classList.add('scroller-item', 'empty');
            return item;
        }

        // Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¯Ø± Ù‡Ø± Ø³ØªÙˆÙ†
        function syncSelection(scroller, selectedValue) {
            // Ø­Ø°Ù Ú©Ù„Ø§Ø³ selected Ø§Ø² Ù‡Ù…Ù‡ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§
            scroller.querySelectorAll('.scroller-item').forEach(item => item.classList.remove('selected'));
            
            // Ø§Ù†ØªØ®Ø§Ø¨ Ø¢ÛŒØªÙ… Ø¬Ø¯ÛŒØ¯
            const itemToSelect = scroller.querySelector(`.scroller-item[data-value="${selectedValue}"]`);
            if (itemToSelect) {
                itemToSelect.classList.add('selected');
            }
        }

        // Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
        function scrollToItem(scroller, index, smooth = true) {
            // Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø² Ø§ÛŒÙ†Ø¯Ú©Ø³ 0 Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ØŒ Ø§Ù…Ø§ 2 Ø¢ÛŒØªÙ… Ø®Ø§Ù„ÛŒ Ø¯Ø± Ø¨Ø§Ù„Ø§ Ø¯Ø§Ø±ÛŒÙ…
            const targetScroll = (index + 2) * ITEM_HEIGHT - ITEM_HEIGHT;
            
            scroller.scrollTo({
                top: targetScroll,
                behavior: smooth ? 'smooth' : 'auto'
            });
        }

        // ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ø§Ø³Ú©Ø±ÙˆÙ„ Ùˆ Ø§Ù†ØªØ®Ø§Ø¨
        function handleScroll(scroller, type) {
            // Ø§Ø¬Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú©Ø¯ Ø¨Ø§ ØªØ£Ø®ÛŒØ±ØŒ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù‡Ø´ Ø¨Ø§Ø± Ù…Ø­Ø§Ø³Ø¨Ø§ØªÛŒ
            if (scroller.scrollTimeout) {
                clearTimeout(scroller.scrollTimeout);
            }

            scroller.scrollTimeout = setTimeout(() => {
                // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø±Ú©Ø²ÛŒâ€ŒØªØ±ÛŒÙ† Ø¢ÛŒØªÙ… Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø§Ø³Ú©Ø±ÙˆÙ„
                const centerIndex = Math.round(scroller.scrollTop / ITEM_HEIGHT);
                
                // Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø² Ø§ÛŒÙ†Ø¯Ú©Ø³ Û² Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ (Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ Û² Ø¢ÛŒØªÙ… Ø®Ø§Ù„ÛŒ)
                const selectedIndex = centerIndex - 1; 
                
                const items = scroller.querySelectorAll('.scroller-item:not(.empty)');

                if (selectedIndex >= 0 && selectedIndex < items.length) {
                    const newValue = parseInt(items[selectedIndex].dataset.value);
                    
                    // Ø§ØµÙ„Ø§Ø­ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø§Ø³Ú©Ø±ÙˆÙ„ Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ù‚ÙÙ„ Ø´Ø¯Ù† Ø±ÙˆÛŒ Ø¢ÛŒØªÙ… (Scroll Snapping)
                    const finalScroll = (selectedIndex + 2) * ITEM_HEIGHT - ITEM_HEIGHT;
                    scroller.scrollTop = finalScroll;

                    let updated = false;

                    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ø¯Ù„ Ø¯Ø§Ø¯Ù‡ Ùˆ Ú©Ù†ØªØ±Ù„ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§
                    if (type === 'year' && selectedDate.year !== newValue) {
                        selectedDate.year = newValue;
                        updated = true;
                    } else if (type === 'month' && selectedDate.month !== newValue) {
                        selectedDate.month = newValue;
                        updated = true;
                    } else if (type === 'day') {
                        selectedDate.day = newValue;
                    }
                    
                    if (updated) {
                        // Ø§Ú¯Ø± Ø³Ø§Ù„ ÛŒØ§ Ù…Ø§Ù‡ Ø¹ÙˆØ¶ Ø´Ø¯ØŒ Ø¨Ø§ÛŒØ¯ Ø±ÙˆØ²Ù‡Ø§ Ø±Ø§ Ø¢Ù¾Ø¯ÛŒØª Ú©Ù†ÛŒÙ…
                        updateDayScroller(); 
                    }
                    
                    // Ù†Ù…Ø§ÛŒØ´ Ø¢ÛŒØªÙ… Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
                    syncSelection(scroller, newValue);
                }
            }, 100); 
        }


        /* ------------------ ØªÙˆØ§Ø¨Ø¹ Ø³Ø§Ø®Øª Ùˆ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ------------------ */

        function initScrollers() {
            // Û±. Ø³Ø§Ù„
            yearScroller.innerHTML = '';
            yearScroller.appendChild(createEmptyItem());
            yearScroller.appendChild(createEmptyItem());
            for (let y = YEAR_END; y >= YEAR_START; y--) { // Ø§Ø² Ø³Ø§Ù„ Ø¬Ø¯ÛŒØ¯ØªØ± Ø¨Ù‡ Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ±
                yearScroller.appendChild(createScrollerItem(y));
            }
            yearScroller.appendChild(createEmptyItem());
            yearScroller.appendChild(createEmptyItem());

            // Û². Ù…Ø§Ù‡
            monthScroller.innerHTML = '';
            monthScroller.appendChild(createEmptyItem());
            monthScroller.appendChild(createEmptyItem());
            MONTHS.forEach((m, index) => {
                monthScroller.appendChild(createScrollerItem(index + 1, m.name)); // Value: 1-12, Label: Name
            });
            monthScroller.appendChild(createEmptyItem());
            monthScroller.appendChild(createEmptyItem());
            
            // Û³. Ø±ÙˆØ² (Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ø³Ø§Ù„ Ùˆ Ù…Ø§Ù‡ Ø§ÙˆÙ„ÛŒÙ‡)
            updateDayScroller();

            // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡
            syncSelection(yearScroller, selectedDate.year);
            syncSelection(monthScroller, selectedDate.month);
            syncSelection(dayScroller, selectedDate.day);

            // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª ØµØ­ÛŒØ­ (Ø¨Ø¯ÙˆÙ† Ø§Ù†ÛŒÙ…ÛŒØ´Ù†)
            const yearIndex = YEAR_END - selectedDate.year;
            const monthIndex = selectedDate.month - 1;
            const dayIndex = selectedDate.day - 1;
            
            scrollToItem(yearScroller, yearIndex, false); 
            scrollToItem(monthScroller, monthIndex, false);
            scrollToItem(dayScroller, dayIndex, false);
        }

        /* ------------------ Event Listeners ------------------ */

        document.addEventListener('DOMContentLoaded', function() {
            // Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ø¯Ø± ÙÛŒÙ„Ø¯ Ù…Ø®ÙÛŒ ØªØ§Ø±ÛŒØ® ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªØŒ Ø¢Ù† Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†
            if (dobHidden.value) {
                const parts = dobHidden.value.split('-');
                if (parts.length === 3) {
                    selectedDate.year = parseInt(parts[0]);
                    selectedDate.month = parseInt(parts[1]);
                    selectedDate.day = parseInt(parts[2]);
                    dobDisplay.innerHTML = `<i class="fas fa-calendar-check"></i> ${dobHidden.value}`;
                    dobDisplay.style.color = 'var(--highlight-color)';
                }
            } else {
                // ØªØ§Ø±ÛŒØ® Ø§ÙˆÙ„ÛŒÙ‡ Ø±Ø§ Ø¨Ù‡ ØªØ§Ø±ÛŒØ® Ø§Ù…Ø±ÙˆØ² - 25 Ø³Ø§Ù„ (Ù…Ø«Ù„Ø§) ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ….
                const today = new Date();
                selectedDate.year = today.getFullYear() - 25; 
                selectedDate.month = today.getMonth() + 1;
                selectedDate.day = today.getDate();
            }

            // Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…ÙˆØ¯Ø§Ù„
            dobDisplay.addEventListener('click', () => {
                initScrollers(); 
                modal.classList.add('open');
            });

            // Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„
            closeBtn.addEventListener('click', () => {
                modal.classList.remove('open');
            });
            modal.addEventListener('click', (e) => {
                if(e.target === modal) {
                    modal.classList.remove('open');
                }
            });

            // Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„
            saveBtn.addEventListener('click', () => {
                // ğŸ’¡ ÙØ±Ù…Øª ØªØ§Ø±ÛŒØ®: YYYY-MM-DD
                const monthPadded = String(selectedDate.month).padStart(2, '0');
                const dayPadded = String(selectedDate.day).padStart(2, '0');
                const finalDate = `${selectedDate.year}-${monthPadded}-${dayPadded}`;
                
                dobHidden.value = finalDate;
                dobDisplay.innerHTML = `<i class="fas fa-calendar-check"></i> ${finalDate}`;
                dobDisplay.style.color = 'var(--highlight-color)';

                modal.classList.remove('open');
            });

            // Ø§ÙØ²ÙˆØ¯Ù† Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø§Ø³Ú©Ø±ÙˆÙ„
            yearScroller.addEventListener('scroll', () => handleScroll(yearScroller, 'year'));
            monthScroller.addEventListener('scroll', () => handleScroll(monthScroller, 'month'));
            dayScroller.addEventListener('scroll', () => handleScroll(dayScroller, 'day'));
            
            // ğŸ’¡ Ø¨Ø±Ø§ÛŒ Ø±ÙØ¹ Ù…Ø´Ú©Ù„ Ù‚ÙÙ„ Ù†Ø´Ø¯Ù† Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¯Ø± Ø¨Ø±Ø®ÛŒ Ù…Ø±ÙˆØ±Ú¯Ø±Ù‡Ø§ (Ø¨Ù‡ Ø®ØµÙˆØµ Ù…ÙˆØ¨Ø§ÛŒÙ„)
            [yearScroller, monthScroller, dayScroller].forEach(scroller => {
                scroller.addEventListener('touchend', () => {
                    // ÛŒÚ© ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø¨Ø§ ØªØ§Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ù‚ÙÙ„ Ú©Ø±Ø¯Ù† Ù†Ù‡Ø§ÛŒÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª
                    setTimeout(() => {
                        if (scroller.id === 'year-scroller') handleScroll(scroller, 'year');
                        if (scroller.id === 'month-scroller') handleScroll(scroller, 'month');
                        if (scroller.id === 'day-scroller') handleScroll(scroller, 'day');
                    }, 50);
                });
            });
        });
    </script>
</body>
</html>