<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyrus AI Image Generator | ØªÙˆÙ„ÛŒØ¯ ØªØµØ§ÙˆÛŒØ± Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --app-height: 100vh;
            --bg-dark: #070707; 
            --card-dark: rgba(28, 28, 28, 0.85); 
            --highlight-color: #03A9F4; 
            --text-color: #FAFAFA;
            --muted-text: #999999;
            --border-radius: 15px; 
            --success-color: #00CC66; 
            --error-color: #FF4444; 
            --loading-color: #FFA500;
        }

        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family:'Vazirmatn', sans-serif;
            background: var(--bg-dark);
            color: var(--text-color);
            width: 100vw; height: var(--app-height); overflow: hidden;
            display: flex; justify-content: center; align-items: center;
        }
        #app-container {
            width: 100%; height: var(--app-height); max-width: 700px;
            display: flex; flex-direction: column;
            background: var(--card-dark);
            backdrop-filter: blur(10px); padding: 15px; overflow: hidden;
        }

        #img-header {
            padding: 20px; text-align: center; font-size: 2rem; font-weight: 900;
            border-bottom: 2px solid var(--highlight-color); margin-bottom: 15px;
            position: relative;
        }

        #back-btn {
            position: absolute; left: 20px; top: 50%; transform: translateY(-50%);
            background: var(--bg-dark); border: none; border-radius: 50%; width: 45px; height: 45px;
            color: var(--muted-text); cursor: pointer;
        }

        #display-area {
            flex: 1; padding: 15px; overflow-y: auto;
            display: flex; flex-direction: column; align-items: center;
            background: rgba(0, 0, 0, 0.4); border-radius: var(--border-radius);
        }

        /* ğŸ–¼ï¸ Ø§ØµÙ„Ø§Ø­ Ø·Ù„Ø§ÛŒÛŒ: Ù‚Ø§Ø¨ Ø¨Ø±Ø´ ØªØµÙˆÛŒØ± Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ù„ÙˆÚ¯Ùˆ */
        #image-crop-container {
            width: 100%;
            max-width: 512px;
            aspect-ratio: 512 / 465; /* Ø¹Ø±Ø¶ Ú©Ø§Ù…Ù„ØŒ Ø§Ù…Ø§ Ø§Ø±ØªÙØ§Ø¹ Ú©Ù…ØªØ± Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø´ Ù„ÙˆÚ¯ÙˆÛŒ Ù¾Ø§ÛŒÛŒÙ† */
            overflow: hidden; /* Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù„ÙˆÚ¯Ùˆ */
            position: relative;
            border-radius: var(--border-radius);
            margin: 20px 0;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
        }

        #generated-image {
            width: 100%;
            height: auto;
            display: block;
            position: absolute;
            top: 0; /* Ú†Ø³Ø¨Ø§Ù†Ø¯Ù† ØªØµÙˆÛŒØ± Ø¨Ù‡ Ø¨Ø§Ù„Ø§ Ø¨Ø±Ø§ÛŒ Ø¨Ø±ÛŒØ¯Ù† Ù„ÙˆÚ¯Ùˆ Ø§Ø² Ù¾Ø§ÛŒÛŒÙ† */
            left: 0;
            transition: opacity 0.8s ease;
        }

        #status-message {
            margin-top: 10px; padding: 10px; border-radius: 8px; font-size: 1rem;
            opacity: 0; transition: 0.5s; direction: rtl;
        }
        #status-message.loading { background: rgba(255,165,0,0.2); color: var(--loading-color); opacity:1; }
        #status-message.error { background: rgba(255,68,68,0.2); color: var(--error-color); opacity:1; }
        #status-message.success { background: rgba(0,204,102,0.2); color: var(--success-color); opacity:1; }

        #input-container {
            display: flex; background: var(--card-dark); padding: 15px;
            border: 1px solid var(--highlight-color); border-radius: var(--border-radius); margin-top: 10px;
        }
        #prompt-input {
            flex: 1; padding: 15px; border: none; border-radius: 30px; background: var(--bg-dark);
            color: white; outline: none; direction: rtl;
        }
        #generate-btn {
            width: 60px; height: 60px; border-radius: 50%; border: none; background: var(--highlight-color);
            cursor: pointer; position: relative;
        }

        .loading-animation {
            border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid white;
            border-radius: 50%; width: 25px; height: 25px; animation: spin 1s linear infinite;
            display: none; position: absolute; top:50%; left:50%; transform: translate(-50%, -50%);
        }

        @keyframes spin { 0%{transform:translate(-50%,-50%) rotate(0)} 100%{transform:translate(-50%,-50%) rotate(360deg)} }

        #download-btn {
            background: var(--highlight-color); border: none; border-radius: 10px; padding: 10px 20px;
            color: black; font-weight: bold; margin: 10px 0; display: none; cursor: pointer;
        }
    </style>
</head>
<body>

<div id="app-container">
    <div id="img-header">
        <button id="back-btn"><i class="fas fa-arrow-right"></i></button>
        ØªÙˆÙ„ÛŒØ¯ ØªØµÙˆÛŒØ± Ù‡ÙˆØ´Ù…Ù†Ø¯
    </div>
    
    <div id="display-area">
        <div id="image-placeholder" style="margin-top:50px; color:#666; text-align:center;">
            Ù…ÙˆØ¶ÙˆØ¹ ØªØµÙˆÛŒØ± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø±ØªØ§Ù† Ø±Ø§ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯...
        </div>
        
        <div id="status-message"></div>

        <div id="image-crop-container">
            <img id="generated-image" src="" alt="AI Image">
        </div>
        
        <button id="download-btn"><i class="fas fa-download"></i> Ø¯Ø§Ù†Ù„ÙˆØ¯ ØªØµÙˆÛŒØ±</button>
    </div>
    
    <div id="input-container">
        <input type="text" id="prompt-input" placeholder="Ù¾Ø±Ø§Ù…Ù¾Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯...">
        <button id="generate-btn">
            <i class="fas fa-magic"></i>
            <div class="loading-animation"></div>
        </button>
    </div>
</div>

<script>
    const promptInput = document.getElementById("prompt-input");
    const generateBtn = document.getElementById("generate-btn");
    const imageContainer = document.getElementById("image-crop-container");
    const generatedImage = document.getElementById("generated-image");
    const statusMsg = document.getElementById("status-message");
    const downloadBtn = document.getElementById("download-btn");
    const placeholder = document.getElementById("image-placeholder");

    async function generateImage() {
        const prompt = promptInput.value.trim();
        if (!prompt) return;

        // UI Reset
        generateBtn.disabled = true;
        generateBtn.querySelector('.fas').style.display = 'none';
        generateBtn.querySelector('.loading-animation').style.display = 'block';
        
        statusMsg.textContent = "Ø¯Ø± Ø­Ø§Ù„ ØªØ±Ø¬Ù…Ù‡ Ùˆ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù„ÛŒÙ†Ú©... â³";
        statusMsg.className = "loading";
        downloadBtn.style.display = 'none';
        placeholder.style.display = 'none';

        try {
            // Û±. Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø¨Ø±Ø§ÛŒ ØªØ±Ø¬Ù…Ù‡ Ùˆ Ú¯Ø±ÙØªÙ† Ù„ÛŒÙ†Ú© (Ø¨Ø³ÛŒØ§Ø± Ø³Ø±ÛŒØ¹ Ú†ÙˆÙ† Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¹Ú©Ø³ Ø¯Ø± Ø³Ø±ÙˆØ± Ø­Ø°Ù Ø´Ø¯Ù‡)
            const res = await fetch("/image_generator", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({prompt})
            });
            const data = await res.json();

            if (res.ok && data.status === "success") {
                // Û². Ù„ÙˆØ¯ ØªØµÙˆÛŒØ± Ù…Ø³ØªÙ‚ÛŒÙ… ØªÙˆØ³Ø· Ù…Ø±ÙˆØ±Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± (Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¨Ù„Ø§Ú© Ø´Ø¯Ù† IP Ø³Ø±ÙˆØ±)
                statusMsg.textContent = "Ù„ÛŒÙ†Ú© Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯. Ù…Ø±ÙˆØ±Ú¯Ø± Ø¯Ø± Ø­Ø§Ù„ Ù„ÙˆØ¯ ØªØµÙˆÛŒØ± Ø§Ø³Øª... ğŸ¨";
                
                generatedImage.src = data.image_url;
                generatedImage.onload = () => {
                    statusMsg.textContent = "ØªØµÙˆÛŒØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯! ğŸ‰";
                    statusMsg.className = "success";
                    imageContainer.style.display = "block";
                    downloadBtn.style.display = "block";
                    resetBtn();
                };
                generatedImage.onerror = () => { throw new Error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØµÙˆÛŒØ±"); };
            } else {
                throw new Error(data.message || "Ø®Ø·Ø§ Ø¯Ø± ØªÙˆÙ„ÛŒØ¯ ØªØµÙˆÛŒØ±");
            }
        } catch (e) {
            statusMsg.textContent = "âŒ Ø®Ø·Ø§: " + e.message;
            statusMsg.className = "error";
            resetBtn();
        }
    }

    function resetBtn() {
        generateBtn.disabled = false;
        generateBtn.querySelector('.fas').style.display = 'block';
        generateBtn.querySelector('.loading-animation').style.display = 'none';
    }

    generateBtn.addEventListener("click", generateImage);
    promptInput.addEventListener("keypress", e => { if(e.key === "Enter") generateImage(); });
    
    downloadBtn.addEventListener("click", () => {
        const link = document.createElement("a");
        link.href = generatedImage.src;
        link.download = `cyrus_image_${Date.now()}.jpg`;
        link.click();
    });

    document.getElementById('back-btn').addEventListener('click', () => window.history.back());
</script>
</body>
</html>