<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyrus AI | Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ØªÙˆÙ„ÛŒØ¯ ØªØµÙˆÛŒØ±</title>
    
    <script>
        !function(e,t,n){e.yektanetAnalyticsObject=n,e[n]=e[n]||function(){e[n].q.push(arguments)},e[n].q=e[n].q||[];var a=t.getElementsByTagName("head")[0],r=new Date,c="https://cdn.yektanet.com/superscript/Zqtus4UG/native-alie-1.onrender.com-45106/yn_pub.js?v="+r.getFullYear().toString()+"0"+r.getMonth()+"0"+r.getDate()+"0"+r.getHours(),s=t.createElement("link");s.rel="preload",s.as="script",s.href=c,a.appendChild(s);var l=t.createElement("script");l.async=!0,l.src=c,a.appendChild(l)}(window,document,"yektanet");
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --app-height: 100vh;
            --bg-dark: #070707; 
            --card-dark: rgba(20, 20, 20, 0.95); 
            --highlight-color: #03A9F4; 
            --text-color: #FAFAFA;
            --muted-text: #888;
            --border-radius: 20px; 
            --success-color: #00E676; 
            --error-color: #FF5252; 
        }

        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family:'Vazirmatn', sans-serif;
            background: var(--bg-dark);
            color: var(--text-color);
            width: 100vw; height: var(--app-height); overflow: hidden;
            display: flex; justify-content: center;
        }
        #app-container {
            width: 100%; height: var(--app-height); max-width: 500px;
            display: flex; flex-direction: column;
            background: var(--card-dark);
            padding: 15px; overflow: hidden;
        }

        #img-header {
            padding: 15px; text-align: center; font-size: 1.5rem; font-weight: 900;
            border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 10px;
            position: relative;
        }

        #back-btn {
            position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
            background: transparent; border: none; color: var(--text-color); font-size: 1.2rem; cursor: pointer;
        }

        #display-area {
            flex: 1; padding: 10px; overflow-y: auto;
            display: flex; flex-direction: column; align-items: center;
            scrollbar-width: none;
        }

        #display-area::-webkit-scrollbar { display: none; }

        .update-notice {
            background: rgba(3, 169, 244, 0.1);
            border: 1px solid var(--highlight-color);
            padding: 12px; border-radius: 12px; font-size: 0.85rem;
            color: var(--highlight-color); text-align: center;
            margin-bottom: 15px; line-height: 1.6; direction: rtl;
        }

        #image-crop-container {
            width: 100%;
            aspect-ratio: 1/0.9; 
            overflow: hidden;
            position: relative;
            border-radius: var(--border-radius);
            margin: 10px 0;
            display: none;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            background: #111;
        }

        #generated-image {
            width: 100%;
            height: auto;
            display: block;
            position: absolute;
            top: 0;
            left: 0;
        }

        #status-message {
            margin: 10px 0; padding: 10px; border-radius: 10px; font-size: 0.9rem;
            opacity: 0; transition: 0.3s; direction: rtl; text-align: center;
        }
        .loading { color: orange; opacity: 1 !important; }
        .error { color: var(--error-color); opacity: 1 !important; }
        .success { color: var(--success-color); opacity: 1 !important; }

        #input-container {
            background: #1a1a1a; padding: 12px; border-radius: 25px;
            display: flex; align-items: center; margin-bottom: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        #prompt-input {
            flex: 1; padding: 10px; border: none; background: transparent;
            color: white; outline: none; font-size: 0.95rem; direction: rtl;
        }
        #generate-btn {
            width: 45px; height: 45px; border-radius: 50%; border: none;
            background: var(--highlight-color); color: black; cursor: pointer;
            display: flex; justify-content: center; align-items: center;
        }

        .spinner {
            width: 20px; height: 20px; border: 3px solid rgba(0,0,0,0.1);
            border-top: 3px solid black; border-radius: 50%;
            animation: spin 0.8s linear infinite; display: none;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #download-btn {
            background: #333; color: white; border: none; border-radius: 12px;
            padding: 12px 25px; font-weight: bold; margin-top: 10px;
            display: none; cursor: pointer; width: 100%;
        }
    </style>
</head>
<body>

<div id="app-container">
    <div id="img-header">
        <button id="back-btn"><i class="fas fa-chevron-right"></i></button>
        Cyrus AI
    </div>
    
    <div id="display-area">
        <div class="update-notice">
            âš ï¸ Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ Ø¢Ù¾Ø¯ÛŒØª Ø²ÛŒØ±Ø³Ø§Ø®ØªØŒ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± ØªØµØ§ÙˆÛŒØ± Ø¯Ø± ÙØ¶Ø§ÛŒ Ø§Ø¨Ø±ÛŒ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ùˆ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ù„ÛŒÙ†Ú© Ù…Ø³ØªÙ‚ÛŒÙ… Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.
        </div>

        <div id="status-message"></div>

        <div id="image-crop-container">
            <img id="generated-image" src="" alt="AI Result">
        </div>
        
        <div id="placeholder" style="margin-top: 50px; color: var(--muted-text); font-size: 0.9rem;">
            Ú†Ù‡ ØªØµÙˆÛŒØ±ÛŒ Ø¯Ø± Ø°Ù‡Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯...
        </div>

        <button id="download-btn"><i class="fas fa-cloud-download-alt"></i> Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ú¯Ø§Ù„Ø±ÛŒ</button>
    </div>
    
    <div id="input-container">
        <input type="text" id="prompt-input" placeholder="ØªÙˆØµÛŒÙ ØªØµÙˆÛŒØ± Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ...">
        <button id="generate-btn">
            <i class="fas fa-bolt" id="btn-icon"></i>
            <div class="spinner" id="btn-loader"></div>
        </button>
    </div>
</div>

<script>
    const promptInput = document.getElementById("prompt-input");
    const generateBtn = document.getElementById("generate-btn");
    const btnIcon = document.getElementById("btn-icon");
    const btnLoader = document.getElementById("btn-loader");
    const imageContainer = document.getElementById("image-crop-container");
    const generatedImage = document.getElementById("generated-image");
    const statusMsg = document.getElementById("status-message");
    const downloadBtn = document.getElementById("download-btn");
    const placeholder = document.getElementById("placeholder");

    async function generate() {
        const prompt = promptInput.value.trim();
        if(!prompt) return;

        // Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ
        generateBtn.disabled = true;
        btnIcon.style.display = "none";
        btnLoader.style.display = "block";
        
        statusMsg.textContent = "Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ùˆ ØªÙˆÙ„ÛŒØ¯ Ù…Ø­ØªÙˆØ§... ğŸ› ï¸";
        statusMsg.className = "loading";
        downloadBtn.style.display = "none";
        placeholder.style.display = "none";

        try {
            const res = await fetch("/image_generator", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({prompt})
            });
            const data = await res.json();

            if(res.ok && data.status === "success") {
                // Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒÙ†Ú© Ù…Ø³ØªÙ‚ÛŒÙ… Ø§Ø² Ø³Ø±ÙˆØ±
                generatedImage.src = data.image_url;
                
                generatedImage.onload = () => {
                    statusMsg.textContent = "ØªØµÙˆÛŒØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯! âœ¨";
                    statusMsg.className = "success";
                    imageContainer.style.display = "block";
                    downloadBtn.style.display = "block";
                    stopLoading();
                };
                
                generatedImage.onerror = () => { throw new Error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø­ØªÙˆØ§"); };
            } else {
                throw new Error(data.message || "Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ù‚Ø±Ø§Ø±ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±");
            }
        } catch (e) {
            statusMsg.textContent = "âŒ Ø®Ø·Ø§: " + e.message;
            statusMsg.className = "error";
            stopLoading();
        }
    }

    function stopLoading() {
        generateBtn.disabled = false;
        btnIcon.style.display = "block";
        btnLoader.style.display = "none";
    }

    generateBtn.addEventListener("click", generate);
    promptInput.addEventListener("keypress", e => { if(e.key === "Enter") generate(); });
    
    downloadBtn.addEventListener("click", () => {
        window.open(generatedImage.src, '_blank');
    });

    document.getElementById('back-btn').addEventListener('click', () => window.history.back());
</script>
</body>
</html>