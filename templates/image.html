<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyrus AI Image Generator | ØªÙˆÙ„ÛŒØ¯ ØªØµØ§ÙˆÛŒØ± Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --app-height: 100vh;
            --bg-dark: #070707; 
            --card-dark: rgba(28, 28, 28, 0.85); 
            --neum-dark: rgba(0, 0, 0, 0.9);
            --neum-light: rgba(255, 255, 255, 0.05); 
            --highlight-color: #03A9F4; 
            --text-color: #FAFAFA;
            --muted-text: #999999;
            --border-radius: 15px; 
            --success-color: #00CC66; 
            --error-color: #FF4444;   
            --loading-color: #FFA500; /* Ø±Ù†Ú¯ Ù†Ø§Ø±Ù†Ø¬ÛŒ Ø¨Ø±Ø§ÛŒ Ù„ÙˆØ¯ÛŒÙ†Ú¯ */
        }

        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family:'Vazirmatn', sans-serif;
            background: var(--bg-dark);
            color: var(--text-color);
            width: 100vw; height: var(--app-height); overflow: hidden;
            display: flex; justify-content: center; align-items: center;
        }
        #app-container {
            width: 100%; height: var(--app-height); max-width: 700px; /* Ø­Ø¯Ø§Ú©Ø«Ø± Ø¹Ø±Ø¶ Ø¨ÛŒØ´ØªØ± Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ØªØ± ØªØµÙˆÛŒØ± */
            display: flex; flex-direction: column;
            background: var(--card-dark);
            backdrop-filter: blur(10px); 
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            border-radius: 0; padding: 15px;
            overflow: hidden;
        }

        /* ğŸ–¼ï¸ Header */
        #img-header {
            padding: 20px 20px; background: var(--card-dark); color: var(--text-color);
            text-align: center; font-size: 2rem; font-weight: 900;
            border-bottom: 2px solid var(--highlight-color); 
            box-shadow: 0 1px 10px rgba(3, 169, 244, 0.3);
            position: relative; z-index: 10; margin-bottom: 15px;
            text-shadow: 0 0 8px rgba(3, 169, 244, 0.8); 
        }

        #back-btn {
            position: absolute; left: 20px; top: 50%; transform: translateY(-50%);
            background: var(--bg-dark); border: none; border-radius: 50%;
            width: 45px; height: 45px; color: var(--muted-text);
            font-size: 1.1rem;
            box-shadow: 5px 5px 12px var(--neum-dark), -5px -5px 12px var(--neum-light);
            transition: all 0.2s ease;
            cursor: pointer;
        }
        #back-btn:hover { color: var(--highlight-color); box-shadow: 0 0 10px var(--highlight-color); }

        /* ğŸ–¼ï¸ Display Area */
        #display-area {
            flex: 1; padding: 15px; overflow-y: auto; scrollbar-width: none;
            display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
            background: rgba(0, 0, 0, 0.4); 
            border-radius: var(--border-radius); 
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.9);
            margin-bottom: 15px;
            position: relative;
        }
        #display-area::-webkit-scrollbar { width: 0; }

        #image-placeholder {
            font-size: 1.2rem; font-weight: 500; color: var(--muted-text);
            text-align: center; padding: 50px 20px; opacity: 0.6;
            margin-top: 100px;
        }
        
        /* ğŸ–¼ï¸ Generated Image */
        #generated-image {
            max-width: 100%;
            height: auto;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.8);
            margin: 20px 0;
            opacity: 0;
            transform: scale(0.98);
            /* ğŸ’¡ Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ù†Ø±Ù… Ùˆ Ø¬Ø°Ø§Ø¨ */
            transition: opacity 0.8s ease-in-out, transform 0.8s ease-in-out;
        }
        #generated-image.visible {
            opacity: 1;
            transform: scale(1);
        }

        /* â¬‡ï¸ Ø¯Ú©Ù…Ù‡ Ø¯Ø§Ù†Ù„ÙˆØ¯ */
        #download-btn {
            background: var(--highlight-color); color: var(--bg-dark);
            border: none; border-radius: 10px; padding: 10px 20px;
            font-size: 1.1rem; font-weight: 700; cursor: pointer;
            margin-top: 10px; margin-bottom: 20px;
            transition: all 0.2s ease;
            display: none;
        }
        #download-btn:hover { background: #0077C0; }
        
        /* ğŸ’¬ Ù¾ÛŒØ§Ù… ÙˆØ¶Ø¹ÛŒØª */
        #status-message {
            margin-top: 10px;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s ease;
            direction: rtl;
        }
        #status-message.success {
            background: rgba(0, 204, 102, 0.2);
            color: var(--success-color);
            opacity: 1;
        }
        #status-message.error {
            background: rgba(255, 68, 68, 0.2);
            color: var(--error-color);
            opacity: 1;
        }
        #status-message.loading {
            background: rgba(255, 165, 0, 0.2);
            color: var(--loading-color);
            opacity: 1;
        }


        /* âŒ¨ï¸ Input Area */
        #input-container {
            display: flex; background: var(--card-dark); padding: 15px; align-items: center;
            border: 1px solid var(--highlight-color); border-radius: var(--border-radius);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.7); z-index: 20;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        #prompt-input {
            flex: 1; padding: 18px 25px; border: none; border-radius: 35px; outline: none;
            font-size: 1.1rem; 
            background: var(--bg-dark); color: var(--text-color);
            margin: 0 10px; 
            box-shadow: inset 5px 5px 10px var(--neum-dark), inset -5px -5px 10px var(--neum-light);
            direction: rtl;
        }

        /* ğŸ’¡ Ø­Ø§Ù„Øª ØºÛŒØ±ÙØ¹Ø§Ù„ Ø¨Ù‡ØªØ± */
        #prompt-input:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            background: #111;
        }
        
        #generate-btn {
            width: 60px; height: 60px; border: none; border-radius: 50%; cursor: pointer;
            font-size: 1.5rem; color: var(--bg-dark);
            background: var(--highlight-color);
            box-shadow: 5px 5px 10px var(--neum-dark), -5px -5px 10px var(--neum-light);
            transition: transform 0.1s ease;
            position: relative;
        }
        #generate-btn:active:not(:disabled) { 
            background: #0077C0; 
            transform: scale(0.9); 
            box-shadow: inset 4px 4px 8px var(--neum-dark), inset -4px -4px 8px var(--neum-light); 
        }
        
        /* ğŸ’¡ Ø­Ø§Ù„Øª ØºÛŒØ±ÙØ¹Ø§Ù„ Ø¯Ú©Ù…Ù‡ */
        #generate-btn:disabled {
            background: #555;
            cursor: wait;
        }

        /* ğŸ”„ Ù„ÙˆØ¯ÛŒÙ†Ú¯ - Ø¯Ø§Ø®Ù„ Ø¯Ú©Ù…Ù‡ */
        .loading-animation {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--text-color);
            border-radius: 50%;
            width: 25px;
            height: 25px;
            animation: spin 1s linear infinite;
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        #generate-btn.generating .fas {
            display: none; /* Ø¢ÛŒÚ©ÙˆÙ† Ø§ØµÙ„ÛŒ Ø±Ø§ Ù¾Ù†Ù‡Ø§Ù† Ú©Ù† */
        }
        #generate-btn.generating .loading-animation {
            display: block; /* Ù„ÙˆØ¯ÛŒÙ†Ú¯ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡ */
        }
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        /* ğŸ“± Mobile Optimization */
        @media (max-width: 600px) {
            #app-container { max-width: 100%; padding: 10px; }
            #img-header { font-size: 1.6rem; padding: 15px 15px; }
            #back-btn { width: 38px; height: 38px; font-size: 1rem; }
            #prompt-input { padding: 12px 15px; font-size: 1rem; margin: 0 5px; }
            #generate-btn { width: 50px; height: 50px; font-size: 1.2rem; }
            #input-container { padding: 10px; }
            #image-placeholder { margin-top: 50px; font-size: 1rem; }
            #status-message { font-size: 0.9rem; }
        }
    </style>
</head>
<body>

<div id="app-container">
    <div id="img-header">
        <button id="back-btn" title="Ø¨Ø§Ø²Ú¯Ø´Øª"> 
            <i class="fas fa-arrow-right"></i>
        </button>
        ØªÙˆÙ„ÛŒØ¯ ØªØµÙˆÛŒØ± Ù‡ÙˆØ´Ù…Ù†Ø¯
    </div>
    
    <div id="display-area">
        <div id="image-placeholder">
            Ù…ÙˆØ¶ÙˆØ¹ ØªØµÙˆÛŒØ± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø±ØªØ§Ù† Ø±Ø§ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹: ÛŒÚ© Ø§Ú˜Ø¯Ù‡Ø§ÛŒ Ù†Ø¦ÙˆÙ†ÛŒØŒ Ù†Ù‚Ø§Ø´ÛŒ Ø¯ÛŒØ¬ÛŒØªØ§Ù„). 
        </div>
        
        <div id="status-message"></div>

        <img id="generated-image" src="" alt="ØªØµÙˆÛŒØ± ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡">
        
        <a id="download-link" download="cyrus_ai_image.jpg">
            <button id="download-btn">
                <i class="fas fa-download"></i> Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¨Ø§ Ú©ÛŒÙÛŒØª Ø¨Ø§Ù„Ø§
            </button>
        </a>
    </div>
    
    <div id="input-container">
        <input type="text" id="prompt-input" placeholder="Ù¾Ø±Ø§Ù…Ù¾Øª Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹: ÛŒÚ© Ø´Ù‡Ø± Ø³Ø§ÛŒØ¨Ø±Ù¾Ø§Ù†Ú©ØŒ 4k)...">
        <button id="generate-btn" title="ØªÙˆÙ„ÛŒØ¯ ØªØµÙˆÛŒØ±">
            <i class="fas fa-magic"></i>
            <div class="loading-animation"></div>
        </button>
    </div>
</div>

<script>
    // Ø¹Ù†Ø§ØµØ± DOM
    const promptInput = document.getElementById("prompt-input");
    const generateBtn = document.getElementById("generate-btn");
    const imagePlaceholder = document.getElementById("image-placeholder");
    const generatedImage = document.getElementById("generated-image");
    const downloadBtn = document.getElementById("download-btn");
    const downloadLink = document.getElementById("download-link");
    const statusMessage = document.getElementById("status-message");
    const backBtn = document.getElementById('back-btn'); // ğŸ‘ˆğŸ‘ˆğŸ‘ˆ Ø¹Ù†ØµØ± Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ú¯Ø´Øª

    const LOCAL_STORAGE_KEY = 'cyrus_image_prompt';

    function setAppHeight() {
        document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
    }
    window.addEventListener('resize', setAppHeight);
    window.addEventListener('orientationchange', setAppHeight);
    setAppHeight();
    
    // ğŸ’¡ ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… ÙˆØ¶Ø¹ÛŒØª
    function showStatus(message, type) {
        statusMessage.textContent = message;
        statusMessage.className = ''; 
        statusMessage.classList.add(type);
        statusMessage.style.opacity = 1;
        // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ø¨Ø§Ù„Ø§ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… ÙˆØ¶Ø¹ÛŒØª
        document.getElementById('display-area').scrollTop = 0; 
    }
    
    function hideStatus() {
        statusMessage.style.opacity = 0;
        statusMessage.textContent = '';
    }
    
    // ğŸ’¡ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¢Ø®Ø±ÛŒÙ† Ù¾Ø±Ø§Ù…Ù¾Øª Ø§Ø² Ù„ÙˆÚ©Ø§Ù„ Ø§Ø³ØªÙˆØ±ÛŒØ¬
    function loadLastPrompt() {
        const lastPrompt = localStorage.getItem(LOCAL_STORAGE_KEY);
        if (lastPrompt) {
            promptInput.value = lastPrompt;
        }
    }
    loadLastPrompt();


    async function generateImage() {
        const prompt = promptInput.value.trim();
        if (!prompt) {
            showStatus("Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ù¾Ø±Ø§Ù…Ù¾Øª Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ ØªØµÙˆÛŒØ± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯. âœï¸", 'error');
            promptInput.focus();
            return;
        }
        
        // Ø°Ø®ÛŒØ±Ù‡ Ù¾Ø±Ø§Ù…Ù¾Øª Ø¯Ø± Ù„ÙˆÚ©Ø§Ù„ Ø§Ø³ØªÙˆØ±ÛŒØ¬
        localStorage.setItem(LOCAL_STORAGE_KEY, prompt);

        // 1. ØªÙ†Ø¸ÛŒÙ… ÙˆØ¶Ø¹ÛŒØª UI
        generateBtn.disabled = true;
        generateBtn.classList.add('generating'); // Ø§ÙØ²ÙˆØ¯Ù† Ú©Ù„Ø§Ø³ Ù„ÙˆØ¯ÛŒÙ†Ú¯
        promptInput.disabled = true;
        generatedImage.classList.remove('visible');
        downloadBtn.style.display = 'none';
        generatedImage.src = ""; // Ø­Ø°Ù ØªØµÙˆÛŒØ± Ù‚Ø¨Ù„ÛŒ
        imagePlaceholder.style.display = 'none';
        
        showStatus("ğŸ’¡ Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯... (ÙØ§Ø² Û±)", 'loading');

        try {
            // 2. Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ Ù…Ø³ÛŒØ± image_generator
            const response = await fetch("/image_generator", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ prompt: prompt })
            });

            const data = await response.json();

            if (response.ok && data.status === "success") {
                // 3. Ù…ÙˆÙÙ‚ÛŒØª: Ù†Ù…Ø§ÛŒØ´ ØªØµÙˆÛŒØ± Ùˆ Ø¯Ú©Ù…Ù‡ Ø¯Ø§Ù†Ù„ÙˆØ¯
                
                // ğŸ’¡ ÙÛŒØ¯Ø¨Ú© Ø¯Ù‚ÛŒÙ‚â€ŒØªØ±
                showStatus("âœ… ØªØµÙˆÛŒØ± ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯! ...", 'success');
                
                generatedImage.src = data.image_url;
                generatedImage.onload = () => {
                    generateBtn.classList.remove('generating');
                    generatedImage.classList.add('visible'); // Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Fade-in Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯
                    downloadBtn.style.display = 'block';
                    
                    downloadLink.href = data.image_url;
                    downloadLink.download = `cyrus_ai_image_${new Date().getTime()}.jpg`;
                    
                    showStatus("ØªØµÙˆÛŒØ± Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯! ğŸ‰", 'success');
                    
                    // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ø¨Ø§Ù„Ø§ Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¯Ù† ØªØµÙˆÛŒØ±
                    document.getElementById('display-area').scrollTop = 0;
                };
                
                // Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø±ÙˆØ² Ø®Ø·Ø§ Ø¯Ø± Ù„ÙˆØ¯ ØªØµÙˆÛŒØ± (Ù…Ø«Ù„Ø§Ù‹ CDN ÛŒØ§...)
                generatedImage.onerror = () => {
                    generateBtn.classList.remove('generating');
                    showStatus("âš ï¸ ØªØµÙˆÛŒØ± ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯ Ø§Ù…Ø§ Ø¯Ø± Ù†Ù…Ø§ÛŒØ´ Ø¢Ù† Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯.", 'error');
                    imagePlaceholder.style.display = 'block';
                };

            } else {
                // 4. Ø®Ø·Ø§
                generateBtn.classList.remove('generating');
                showStatus(`âŒ ${data.message || "Ø®Ø·Ø§ Ø¯Ø± ØªÙˆÙ„ÛŒØ¯ ØªØµÙˆÛŒØ± Ø±Ø® Ø¯Ø§Ø¯."} Ù„Ø·ÙØ§Ù‹ Ù¾Ø±Ø§Ù…Ù¾Øª Ø¯ÛŒÚ¯Ø±ÛŒ Ø±Ø§ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯.`, 'error');
                imagePlaceholder.style.display = 'block';
            }

        } catch (e) {
            console.error("Image generation error:", e);
            generateBtn.classList.remove('generating');
            showStatus("âš ï¸ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ ÛŒØ§ Ø³Ø±ÙˆØ±. Ù„Ø·ÙØ§Ù‹ Ø§ØªØµØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.", 'error');
            imagePlaceholder.style.display = 'block';
        } finally {
            // 5. Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª UI
            generateBtn.disabled = false;
            promptInput.disabled = false;
        }
    }

    // Event Listeners
    generateBtn.addEventListener("click", generateImage);
    promptInput.addEventListener("keypress", e => { 
        if (e.key === "Enter" && !generateBtn.disabled) generateImage(); 
    });

    // ğŸ’¡ğŸ‘ˆğŸ‘ˆğŸ‘ˆ Ø§ØµÙ„Ø§Ø­ Ù…Ù‡Ù… Ø¨Ø±Ø§ÛŒ Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø±Ø¹Øª Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ú¯Ø´Øª: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² history.back()
    backBtn.addEventListener('click', () => {
        // Ø§ÛŒÙ† Ù…ØªØ¯ Ø§ØºÙ„Ø¨ Ø§Ø² Ú©Ø´ Ù…Ø±ÙˆØ±Ú¯Ø± (BFCache) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ Ø³Ø±Ø¹Øª Ø¨Ø§Ø²Ú¯Ø´Øª Ø±Ø§ Ø¨Ø³ÛŒØ§Ø± Ø¨Ø§Ù„Ø§ Ù…ÛŒâ€ŒØ¨Ø±Ø¯.
        window.history.back();
    });
</script>
</body>
</html>